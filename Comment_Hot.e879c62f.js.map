{"version":3,"file":"Comment_Hot.e879c62f.js","mappings":"iRAOA,SAAeA,EAAAA,EAAAA,OAAK,YAAY,IAATC,EAAS,EAATA,GACrB,GAAwBC,EAAAA,EAAAA,UAAS,IAAjC,eAAOC,EAAP,KAAaC,EAAb,KACMC,GAAaC,EAAAA,EAAAA,SAAO,GACpBC,GAASD,EAAAA,EAAAA,QAAO,GAChBE,GAAcF,EAAAA,EAAAA,QAAO,MACrBG,GAAYH,EAAAA,EAAAA,QAAO,MA4BnBI,EAAU,mCAAG,2FACZL,EAAWM,QADC,0CACe,GADf,iCAGwBC,EAAAA,EAAAA,IAAc,CACnDX,GAAAA,EACAY,KAAM,EACNC,MAjCQ,GAkCRP,OAAQA,EAAOI,UAPF,gBAGPI,EAHO,EAGPA,YAAaC,EAHN,EAGMA,QAMrBX,EAAWM,QAAUK,EAErBT,EAAOI,SAtCG,GAyCVP,GAAQ,SAACD,GAAD,wBAAcA,IAAd,OAAuBY,OAdhB,kDAiBfE,QAAQC,IAAR,MAjBe,0DAAH,qDAwBhB,OAHAC,EAAAA,EAAAA,GAAYT,EAAYD,EAAWD,GAIjC,yBACEY,UAAU,0DACVC,IAAKZ,GAEL,yBAAKW,UAAU,MAAf,QACA,yBAAKA,UAAU,mBACZjB,EAAKmB,KAAI,SAACC,GAAD,OACR,kBAAC,IAAD,CACEA,KAAMA,EAENC,IAAKD,EAAKE,eAGbpB,EAAWM,SACV,yBAAKS,UAAU,4BACb,kBAAC,IAAD,OAGJ,yBAAKC,IAAKb","sources":["webpack://wyy/./src/pages/Comment/Hot.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef, memo } from \"react\";\nimport { apiCommentHot, apiCommentLike } from \"@/api\";\nimport DomComment from \"@/components/Comment\";\nimport useInfinite from \"@/hooks/useInfinite\";\nimport DomLoading from \"@/components/Loading\";\nimport produce from \"immer\";\n\nexport default memo(({ id }) => {\n  const [data, setData] = useState([]);\n  const refHasMore = useRef(true);\n  const offset = useRef(0);\n  const domObserver = useRef(null);\n  const domScroll = useRef(null);\n  const limit = 20;\n\n  const handleLike = async (cid, t) => {\n    try {\n      const { code } = await apiCommentLike({\n        id,\n        cid,\n        t: t ? 0 : 1,\n        type: 0,\n      });\n      if (code === 200) {\n        setData(\n          produce((draft) => {\n            draft.forEach((item) => {\n              if (item.commentId === cid) {\n                item.liked = !t;\n                item.likedCount += t ? -1 : 1;\n              }\n            });\n          })\n        );\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const handleInit = async () => {\n    if (!refHasMore.current) return false;\n    try {\n      const { hotComments, hasMore } = await apiCommentHot({\n        id,\n        type: 0,\n        limit,\n        offset: offset.current,\n      });\n      refHasMore.current = hasMore;\n\n      offset.current += limit;\n      // const a = [...data, ...hotComments];\n      // console.log(data.concat(hotComments));\n      setData((data) => [...data, ...hotComments]);\n      // console.log(data); data 只能拿到空数组\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  useInfinite(handleInit, domScroll, domObserver);\n\n  // if (loading) return <div>loading</div>;\n  return (\n    <div\n      className=\"domComment px-8 py-5 overflow-auto max-h-full flex-auto\"\n      ref={domScroll}\n    >\n      <div className=\"h1\">精彩评论</div>\n      <div className=\"domComment_list\">\n        {data.map((item) => (\n          <DomComment\n            item={item}\n            // handleLike={handleLike}\n            key={item.commentId}\n          />\n        ))}\n        {refHasMore.current && (\n          <div className=\"flex justify-center py-4\">\n            <DomLoading />\n          </div>\n        )}\n        <div ref={domObserver} />\n      </div>\n    </div>\n  );\n});\n"],"names":["memo","id","useState","data","setData","refHasMore","useRef","offset","domObserver","domScroll","handleInit","current","apiCommentHot","type","limit","hotComments","hasMore","console","log","useInfinite","className","ref","map","item","key","commentId"],"sourceRoot":""}