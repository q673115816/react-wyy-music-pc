"use strict";(this.webpackChunkwyy=this.webpackChunkwyy||[]).push([[8113],{1753:(e,t,n)=>{n.r(t),n.d(t,{default:()=>j});var a=n(885),c=n(7363),o=n.n(c),r=n(57),s=n(6711),u=n(5861),l=n(7757),i=n.n(l),m=n(7467),d=n.n(m),f=n(7453),p=n(4849);n(1249),n(2222);const E=(0,c.memo)((function(e){var t=e.list,n=(0,s.useLocation)().pathname;return o().createElement("div",{className:"grid grid-cols-3 gap-5"},t.map((function(e){var t=(0,a.Z)(e,2),c=t[0],r=t[1];return o().createElement("div",{key:c},o().createElement(s.Link,{to:"".concat(n,"/").concat(c)},o().createElement("img",{className:"ui_aspect-ratio-16/9 cursor-pointer",loading:"lazy",src:r.banner,alt:""})),o().createElement(s.Link,{to:"".concat(n,"/").concat(c),className:"cursor-pointer"},r.title),o().createElement("div",null,o().createElement(s.Link,{to:"/"},r.user)))})))}));var v=n(2924),h="https://enigmatic-forest-38434.herokuapp.com",k=n.n(v)()(h,{autoConnect:!1});k.on("create-success",(function(e){console.log(e)})),k.on("join-success",(function(e){console.log(e)})),k.on("disconnect-success",(function(e){console.log(e)}));const y=k,N=(0,c.memo)((function(){var e=(0,c.useState)(20),t=(0,a.Z)(e,2),n=(t[0],t[1],(0,c.useRef)(null)),r=(0,c.useRef)(null),l=(0,c.useState)([]),m=(0,a.Z)(l,2),v=(m[0],m[1],(0,f.useQuery)("look",(0,u.Z)(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d().get("".concat(h,"/list")).then((function(e){return e.data}));case 2:return t=e.sent,n=t.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)}))))),k=v.data,y=(v.error,v.isLoading),N=v.isSuccess;return v.status,o().createElement("div",{className:"domLook overflow-auto max-h-full flex-auto",ref:n},o().createElement("div",{className:"domLook_header ui_header"},o().createElement("span",{className:"title h1"},"LOOK直播"),o().createElement("span",{className:"text-gray-400 slogan ml-2"},"在这里，看见音乐"),o().createElement(s.Link,{to:function(e){var t=e.pathname;return"".concat(t,"/my")},className:"ml-2 py-1 px-2 rounded bg-red-500 text-white"},"我的直播"),o().createElement("a",{href:"https://look.163.com/hot",className:"text-gray-400 ml-auto"},"更多 >")),o().createElement("div",{className:"px-8"},y&&o().createElement("div",{className:"pt-48 flex-center"},o().createElement(p.Z,null)),N&&o().createElement(E,{list:k}),o().createElement("div",{ref:r})))}));n(2772),n(4916),n(4723),n(4747);var C=n(4184),T=n.n(C),g="SOCKET_CONNECT",S="SOCKET_DISCONNECT",w="SOCKET_DESKTOP_START",x="SOCKET_DESKTOP_END",O="SOCKET_USER_START",R="SOCKET_USER_END",_="SOCKET_PUSH_START",b="SOCKET_PUSH_END",K=function(e,t){switch(t.type){case g:return y.connect(),void(e.status.connect=!0);case S:return y.disconnect(),void(e.status.connect=!1);case w:return void(e.status.deskTop=!0);case x:return void(e.status.deskTop=!1);case O:return void(e.status.user=!0);case R:return void(e.status.user=!1);case _:return y.emit("create",{user:"user",title:"title"}),void(e.status.push=!0);case b:return void(e.status.push=!1);default:return e}},D={status:{connect:!1,deskTop:!1,user:!1,push:!1}},L=(0,c.memo)((function(e){var t=e.onClick,n=e.children,a=e.status;return o().createElement("button",{type:"button",className:T()("text-white rounded p-2",a?"bg-red-500":"bg-blue-500"),onClick:t},n)}));const P=(0,c.memo)((function(){var e=(0,c.useContext)(U),t=e.lookReducer,n=t.status,a=(t.socket,e.lookDispatch),r=(0,c.useRef)(null),s=((0,c.useRef)(null),(0,c.useRef)(null)),u=function(e,t,n){navigator.mediaDevices[t]({video:!0,audio:!0}).then((function(t){e.srcObject=t,n&&n()})).catch((function(e){return console.log(e)}))},l=function(e,t){var n;(null===(n=e.srcObject)||void 0===n?void 0:n.getTracks()).forEach((function(e){return e.stop()})),e.srcObject=null,t&&t()};return o().createElement("div",{className:"w-full h-full p-8 overflow-auto"},o().createElement("div",{className:"flex"},o().createElement(L,{onClick:function(){n.deskTop?l(r.current,(function(){a({type:x})})):u(r.current,"getDisplayMedia",(function(){a({type:w})}))},status:n.deskTop},"桌面共享开关"),o().createElement(L,{onClick:function(){n.user?l(s.current,(function(){a({type:R})})):u(s.current,"getUserMedia",(function(){a({type:O})}))},status:n.user},"摄像头开关"),o().createElement(L,{onClick:function(){n.push?a({type:b}):(a({type:_}),new RTCPeerConnection({}).addEventListener("icecandidate",(function(e){e.target;var t=e.candidate;t&&new RTCIceCandidate(t)})))},status:n.push},"推送开关")),o().createElement("div",{className:"flex flex-col"},o().createElement("div",{className:""},o().createElement("video",{className:"w-full",ref:r,autoPlay:!0,playsInline:!0})),o().createElement("div",{className:""},o().createElement("video",{className:"w-full",ref:s,autoPlay:!0,playsInline:!0}))))})),Z=(0,c.memo)((function(){return o().createElement("div",{className:"p-8"},o().createElement("video",{className:"w-full",autoPlay:!0,playsInline:!0}))}));var I=n(1343),U=(0,c.createContext)(null);const j=(0,c.memo)((function(){(0,I.T)();var e=(0,r.C)(K,D),t=(0,a.Z)(e,2),n=t[0],u=t[1];return(0,c.useEffect)((function(){return u({type:g}),function(){u({type:S})}}),[]),o().createElement(U.Provider,{value:{lookReducer:n,lookDispatch:u}},o().createElement(s.Switch,null,o().createElement(s.Route,{path:"/look",exact:!0,component:N}),o().createElement(s.Route,{path:"/look/my",component:P}),o().createElement(s.Route,{path:"/look/:id(\\d*)",component:Z})))}))}}]);