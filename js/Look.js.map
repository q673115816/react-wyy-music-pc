{"version":3,"file":"js/Look.js?version=d3dde950","mappings":"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","sources":["webpack://wyy/./src/features/Look/socket.ts","webpack://wyy/./src/features/Look/Content.ts","webpack://wyy/./src/features/Look/Look.tsx","webpack://wyy/./src/features/Look/Home/List.tsx","webpack://wyy/./src/features/Look/Home/Home.tsx","webpack://wyy/./src/features/Look/config.ts","webpack://wyy/./src/features/Look/Live/Live.tsx","webpack://wyy/./src/features/Look/Live/useGetInput.tsx","webpack://wyy/./src/features/Look/Room/Room.tsx","webpack://wyy/./src/features/Look/Router.tsx"],"sourcesContent":["import io from \"socket.io-client\";\n\nconst socket = io(LIVE_URL, {\n  autoConnect: false,\n});\n\nsocket.on(\"create-success\", (data) => {\n  console.log(data);\n});\n\nsocket.on(\"create-error\", (data) => {\n  console.log(data);\n});\n\nsocket.on(\"join-success\", (data) => {\n  console.log(data);\n});\n\nsocket.on(\"disconnect-success\", (data) => {\n  console.log(data);\n});\n\nsocket.on(\"list-success\", (data) => {\n  console.log(data);\n});\n\nexport default socket;\n","import socket from \"./socket\";\nimport { Socket } from \"socket.io-client\";\nexport const SOCKET_CONNECT = \"SOCKET_CONNECT\";\nexport const SOCKET_DISCONNECT = \"SOCKET_DISCONNECT\";\nexport const SOCKET_DESKTOP_START = \"SOCKET_DESKTOP_START\";\nexport const SOCKET_DESKTOP_END = \"SOCKET_DESKTOP_END\";\nexport const SOCKET_USER_START = \"SOCKET_USER_START\";\nexport const SOCKET_USER_END = \"SOCKET_USER_END\";\nexport const SOCKET_PUSH_START = \"SOCKET_PUSH_START\";\nexport const SOCKET_PUSH_END = \"SOCKET_PUSH_END\";\nexport const SOCKET_JOIN_START = \"SOCKET_JOIN_START\";\nexport const SOCKET_JOIN_END = \"SOCKET_JOIN_END\";\n\nexport interface LookState {\n  status: {\n    connect: boolean;\n    deskTop: boolean;\n    user: boolean;\n    push: boolean;\n    faceDetector: boolean;\n  };\n  socket: Socket;\n}\n\nexport const LookReducer = (draft: LookState, { type, payload }: any) => {\n  switch (type) {\n    case SOCKET_CONNECT:\n      socket.connect();\n      draft.status.connect = true;\n      return;\n    case SOCKET_DISCONNECT:\n      socket.disconnect();\n      draft.status.connect = false;\n      return;\n    case SOCKET_DESKTOP_START:\n      draft.status.deskTop = true;\n      return;\n    case SOCKET_DESKTOP_END:\n      draft.status.deskTop = false;\n      return;\n    case SOCKET_USER_START:\n      draft.status.user = true;\n      return;\n    case SOCKET_USER_END:\n      draft.status.user = false;\n      return;\n    case SOCKET_PUSH_START:\n      draft.socket.emit(\"create\", payload);\n      draft.status.push = true;\n      return;\n    case SOCKET_PUSH_END:\n      draft.socket.emit(\"close\", payload);\n      draft.status.push = false;\n      return;\n    case SOCKET_JOIN_START:\n      draft.socket.emit(\"join\", payload);\n      return;\n    default:\n      return draft;\n  }\n};\n\nexport const LookInitialState: LookState = {\n  status: {\n    connect: false,\n    deskTop: false,\n    user: false,\n    push: false,\n    faceDetector: false,\n  },\n  socket,\n};\n","import React, { memo, useEffect, createContext } from \"react\";\nimport { useImmerReducer } from \"use-immer\";\nimport { Routes, Route, Outlet } from \"react-router-dom\";\nimport adapter from \"webrtc-adapter\";\nimport { useAppDispatch } from \"@/reducers/hooks\";\nimport {\n  LookInitialState,\n  LookReducer,\n  SOCKET_CONNECT,\n  SOCKET_DISCONNECT,\n} from \"./Content\";\nimport getIP from \"./getIP\";\n\nexport const LookContent = createContext<any>(null);\n\nexport default memo(function Base() {\n  const dispatch = useAppDispatch();\n  const [lookReducer, lookDispatch] = useImmerReducer(\n    LookReducer,\n    LookInitialState\n  );\n  useEffect(() => {\n    lookDispatch({ type: SOCKET_CONNECT });\n    return () => {\n      lookDispatch({ type: SOCKET_DISCONNECT });\n    };\n  }, []);\n  return (\n    <LookContent.Provider value={{ lookReducer, lookDispatch }}>\n      <Outlet />\n    </LookContent.Provider>\n  );\n});\n","import React, { FC, memo } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { iHome } from \"./types\";\n\nconst Home: FC<iHome> = ({ list }) => {\n  return (\n    <div className={`grid grid-cols-3 gap-5`}>\n      {list.map(({ uid = \"\", title = \"\", banner = \"\", user = \"\" }) => (\n        <div key={uid}>\n          <Link to={uid}>\n            <img\n              className={`ui_aspect-ratio-16/9 cursor-pointer`}\n              loading={`lazy`}\n              src={banner}\n              alt=\"\"\n            />\n          </Link>\n          <Link to={uid} className={`cursor-pointer`}>\n            {title}\n          </Link>\n          <div>\n            <Link to={`/user/${uid}`}>{user}</Link>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default memo(Home);\n","import React, {\n  useState,\n  memo,\n  useRef,\n  useEffect,\n  useCallback,\n  MouseEventHandler,\n  useContext,\n} from \"react\";\nimport useInfinite from \"@/hooks/useInfinite\";\nimport { Link, useLocation } from \"react-router-dom\";\nimport { useQuery } from \"react-query\";\nimport Loading from \"@/components/Loading\";\nimport Rea from \"react-error-boundary\";\nimport socket from \"../socket\";\nimport { iList } from \"./types\";\nimport LiveList from \"./List\";\nimport { LookContent } from \"../Look\";\n\nexport default memo(function Home() {\n  const [size, setSize] = useState(20);\n  const {\n    lookReducer: { socket },\n    lookDispatch,\n  } = useContext(LookContent);\n\n  const DomScroll = useRef(null);\n  const DomObserver = useRef(null);\n  const [list, setList] = useState<iList>([]);\n  // useInfinite(() => { setSize((prev) => prev + 20); }, DomScroll, DomObserver);\n  const { data = [], error, isLoading, isSuccess, status } = useQuery(\n    \"look\",\n    async () => {\n      const { data } = await fetch(`${LIVE_URL}/list`).then((res) => res.json())\n      return data;\n    }\n  );\n\n  return (\n    <div className=\"domLook overflow-auto max-h-full flex-auto\" ref={DomScroll}>\n      <div className=\"domLook_header ui_header\">\n        <span className=\"title h1\">LOOK直播</span>\n        <span className=\"text-gray-400 slogan ml-2\">在这里，看见音乐</span>\n        <Link\n          to={`my`}\n          className=\"ml-2 py-1 px-2 rounded bg-red-500 text-white\"\n        >\n          我的直播\n        </Link>\n        <a href=\"https://look.163.com/hot\" className=\"text-gray-400 ml-auto\">\n          更多 &gt;\n        </a>\n      </div>\n      <div className=\"px-8\">\n        <LiveList list={data} />\n        <div ref={DomObserver} />\n      </div>\n    </div>\n  );\n});\n","export const configuration: RTCConfiguration = {\n  iceServers: [\n    {\n      urls: [\n        \"stun:stun.xten.com\",\n        \"stun:stun.services.mozilla.com\",\n        \"stun:stun1.l.google.com:19302\",\n        \"stun:stun2.l.google.com:19302\",\n      ],\n    },\n  ],\n}\n","import React, {\n  EventHandler,\n  FC,\n  memo,\n  MouseEventHandler,\n  ReactEventHandler,\n  ReactNode,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport classnames from \"classnames\";\nimport useLoginStatus, { handleLoginStatus } from \"@/hooks/useLoginStatus\";\nimport { LookContent } from \"@/features/Look/Look\";\nimport {\n  SOCKET_DESKTOP_END,\n  SOCKET_DESKTOP_START,\n  SOCKET_PUSH_END,\n  SOCKET_PUSH_START,\n  SOCKET_USER_END,\n  SOCKET_USER_START,\n} from \"../Content\";\nimport { configuration } from \"../config\";\nimport useGetInput from \"@/features/Look/Live/useGetInput\";\n// 以下代码是从网上找的\n//=========================================================================================\n//如果返回的是false说明当前操作系统是手机端，如果返回的是true则说明当前的操作系统是电脑端\n\nfunction IsPC() {\n  const userAgentInfo = navigator.userAgent;\n  const Agents = [\n    \"Android\",\n    \"iPhone\",\n    \"SymbianOS\",\n    \"Windows Phone\",\n    \"iPad\",\n    \"iPod\",\n  ];\n  let flag = true;\n\n  for (let v = 0; v < Agents.length; v++) {\n    if (userAgentInfo.indexOf(Agents[v]) > 0) {\n      flag = false;\n      break;\n    }\n  }\n\n  return flag;\n}\n\n//如果返回true 则说明是Android  false是ios\nfunction is_android() {\n  const u = navigator.userAgent,\n    app = navigator.appVersion;\n  const isAndroid = u.indexOf(\"Android\") > -1 || u.indexOf(\"Linux\") > -1; //g\n  const isIOS = !!u.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端\n  if (isAndroid) {\n    //这个是安卓操作系统\n    return true;\n  }\n\n  if (isIOS) {\n    //这个是ios操作系统\n    return false;\n  }\n}\n\ninterface iButtonProps {\n  onClick: MouseEventHandler;\n  status: boolean;\n}\n\nconst Button: FC<iButtonProps> = ({ onClick, children, status }) => {\n  return (\n    <button\n      type={\"button\"}\n      className={classnames(\n        `text-white rounded p-2`,\n        status ? \"bg-red-500\" : \"bg-blue-500\"\n      )}\n      onClick={onClick}\n    >\n      {children}\n    </button>\n  );\n};\n\n/*\n * TODO\n *  1.信令系统\n *  2.摄像头叠加桌面，如基本直播\n * */\nexport default memo(function Live() {\n  const {\n    lookReducer: { status, socket },\n    lookDispatch,\n  } = useContext(LookContent);\n  // const [isSupport] = useState<boolean>(() => {\n  //   return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);\n  // });\n\n  const { audioinput, videoinput } = useGetInput();\n\n  const RefVideo = useRef<HTMLVideoElement>(null);\n  const RefDeskTop = useRef<HTMLVideoElement>(null);\n  const RefDeskTopStream = useRef<MediaStream>(null);\n  const RefUser = useRef<HTMLCanvasElement>(null);\n  const RefUserStream = useRef<MediaStream>(null);\n  const RefMixin = useRef<HTMLCanvasElement>(null);\n  const RefCtx = useRef<CanvasRenderingContext2D>(null);\n  const RefMixinCtx = useRef<CanvasRenderingContext2D>(null);\n  const RefFace = useRef(new FaceDetector());\n  const RefRTC = useRef(\n    (() => {\n      const pc = new RTCPeerConnection(configuration);\n      pc.addEventListener(\"icecandidate\", (e) => {\n        const peerConnection = e.target;\n        const iceCandidate = e.candidate;\n        if (iceCandidate) {\n          const newIceCandidate = new RTCIceCandidate(iceCandidate);\n          // const otherPeer;\n        }\n      });\n      return pc;\n    })()\n  );\n\n  const handleDeskTopClose = () => {\n    const diskTop = RefDeskTop.current as HTMLVideoElement;\n    const tracks = (diskTop.srcObject as MediaStream).getTracks();\n    tracks.forEach((track) => track.stop());\n    diskTop.srcObject = null;\n    lookDispatch({ type: SOCKET_DESKTOP_END });\n  };\n\n  const handleDeskTopOpen = async () => {\n    const diskTop = RefDeskTop.current as HTMLVideoElement;\n    const mediaStream = await navigator.mediaDevices.getDisplayMedia({\n      audio: true,\n      video: true,\n    });\n    RefDeskTopStream.current = mediaStream;\n    diskTop.srcObject = mediaStream;\n    const tracks = mediaStream.getTracks();\n    const sender = RefRTC.current.addTrack(tracks[0], mediaStream);\n    tracks[0].onended = () => {\n      RefRTC.current.removeTrack(sender);\n      lookDispatch({ type: SOCKET_DESKTOP_END });\n    };\n    lookDispatch({ type: SOCKET_DESKTOP_START });\n  };\n\n  const handleDeskTop: MouseEventHandler = () => {\n    if (!(navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia))\n      return false;\n\n    if (status.deskTop) {\n      handleDeskTopClose();\n    } else {\n      handleDeskTopOpen();\n    }\n  };\n\n  const handleUserOpen: MouseEventHandler = async () => {\n    const video = RefVideo.current as HTMLVideoElement;\n    const mediaStream = await navigator.mediaDevices.getUserMedia({\n      // audio: true,\n      video: {\n        width: { ideal: 1280 },\n        height: { ideal: 720 },\n      },\n    });\n    RefUserStream.current = mediaStream;\n    video.srcObject = mediaStream;\n    lookDispatch({ type: SOCKET_USER_START });\n  };\n\n  const handleUserClose: MouseEventHandler = async () => {\n    const video = RefVideo.current as HTMLVideoElement;\n    const tracks = (video.srcObject as MediaStream).getTracks();\n    tracks.forEach((track) => track.stop());\n    video.srcObject = null;\n    lookDispatch({ type: SOCKET_USER_END });\n  };\n\n  const handleSend: MouseEventHandler = () => {\n    if (status.push) handlePushClose();\n    else handlePushOpen();\n  };\n\n  const handlePushOpen = () => {\n    lookDispatch({\n      type: SOCKET_PUSH_START,\n      payload: {\n        title: \"6666\",\n        user: \"337845818\",\n        uid: \"337845818\",\n        banner:\n          \"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.jj20.com%2Fup%2Fallimg%2Ftp03%2F1Z9211616415M2-0-lp.jpg&refer=http%3A%2F%2Fimg.jj20.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1642140129&t=1cd7e5653b612ffbe71c1f461c5cb387\",\n        sdp: \"\",\n      },\n    });\n  };\n  const handlePushClose = () => {\n    lookDispatch({ type: SOCKET_PUSH_END, payload: { uid: \"337845818\" } });\n  };\n\n  useEffect(() => handlePushClose, []);\n\n  const handleSetEleSize =\n    ({\n      current: ref,\n    }: {\n      current: HTMLCanvasElement;\n    }): ReactEventHandler<HTMLVideoElement> =>\n    ({ target }) => {\n      const width = target.clientWidth;\n      const height = target.clientHeight;\n      ref.width = width;\n      ref.height = height;\n    };\n\n  const handleFaceDetector = async () => {\n    requestAnimationFrame(handleFaceDetector);\n    const user = RefUser.current as HTMLCanvasElement;\n    const ctx = RefCtx.current as CanvasRenderingContext2D;\n    const { width, height } = user;\n    const faces = await RefFace.current\n      .detect(RefVideo.current)\n      .catch((e: any) => console.log(e));\n    ctx.clearRect(0, 0, width, height);\n    ctx.beginPath();\n    ctx.lineWidth = 3;\n    ctx.strokeStyle = \"lime\";\n    ctx.setLineDash([5]);\n    for (const { boundingBox: face } of faces) {\n      ctx.strokeRect(face.x, face.y, face.width, face.height);\n    }\n  };\n  useEffect(() => {\n    RefCtx.current = (RefUser.current as HTMLCanvasElement).getContext(\"2d\");\n  }, [RefUser]);\n  useEffect(() => {\n    RefMixinCtx.current = (RefMixin.current as HTMLCanvasElement).getContext(\n      \"2d\"\n    );\n  }, [RefMixin]);\n\n  useEffect(() => {}, [RefDeskTopStream, RefUserStream]);\n\n  useEffect(() => {\n    if (status.deskTop) {\n      console.log(\"mixin in\");\n      RefMixinCtx.current.drawImage(RefDeskTop.current, 0, 0);\n    }\n  }, [status.deskTop]);\n  return (\n    <div className={`w-full h-full p-8 overflow-auto`}>\n      <div className={`flex`}>\n        <Button onClick={handleDeskTop} status={status.deskTop}>\n          桌面共享开关\n        </Button>\n        <Button onClick={handleUserOpen} status={status.user}>\n          摄像头开\n        </Button>\n        <Button onClick={handleUserClose} status={!status.user}>\n          摄像头关\n        </Button>\n        <Button onClick={handleFaceDetector} status={status.faceDetector}>\n          人脸识别\n        </Button>\n        <Button onClick={handlePushOpen} status={status.push}>\n          推送\n        </Button>\n        <Button onClick={handlePushClose} status={!status.push}>\n          关闭推送\n        </Button>\n      </div>\n      <div className=\"flex\">\n        <span>音频输入</span>\n        <select className={`border`}>\n          {audioinput.map((item, index) => {\n            return (\n              <option value=\"\" key={index}>\n                {item.label}\n              </option>\n            );\n          })}\n        </select>\n        <span>视频输入</span>\n        <select className={`border`}>\n          {videoinput.map((item, index) => {\n            return (\n              <option value=\"\" key={index}>\n                {item.label}\n              </option>\n            );\n          })}\n        </select>\n      </div>\n      <div className={`flex flex-col`}>\n        <div className={``}>\n          <video\n            className={`w-full`}\n            ref={RefDeskTop}\n            autoPlay\n            playsInline\n            onLoadedMetadata={handleSetEleSize(RefMixin)}\n          />\n        </div>\n        <hr />\n        <div className={\"relative\"}>\n          <video\n            className={`w-full`}\n            ref={RefVideo}\n            autoPlay\n            playsInline\n            style={{ transform: `scale(-1, 1)` }}\n            onLoadedMetadata={handleSetEleSize(RefUser)}\n          />\n          <canvas\n            className={`absolute inset-0 w-full h-full`}\n            style={{ transform: `scale(-1, 1)` }}\n            ref={RefUser}\n          />\n        </div>\n      </div>\n      <hr />\n      <div>\n        <canvas className=\"w-full\" ref={RefMixin} />\n      </div>\n    </div>\n  );\n});\n","import React, { useEffect, useState } from \"react\";\n\nconst useGetInput = () => {\n  const [audioinput, setAudioinput] = useState<MediaDeviceInfo[]>([]);\n  const [videoinput, setVideoinput] = useState<MediaDeviceInfo[]>([]);\n  useEffect(() => {\n    (async () => {\n      const deviceInfos = await navigator.mediaDevices.enumerateDevices();\n      const audioinput = [];\n      const videoinput = [];\n      for (const deviceInfo of deviceInfos) {\n        if (deviceInfo.kind === \"audioinput\") {\n          audioinput.push(deviceInfo);\n        } else if (deviceInfo.kind === \"videoinput\") {\n          videoinput.push(deviceInfo);\n        } else {\n          console.log(\"other kind: \", deviceInfo);\n        }\n      }\n      setAudioinput(audioinput);\n      setVideoinput(videoinput);\n    })();\n  }, []);\n  return {\n    audioinput,\n    videoinput\n  }\n}\n\nexport default useGetInput\n","import React, { memo, useContext, useEffect, useRef } from \"react\";\nimport { useParams } from \"react-router-dom\";\nimport { LookContent } from \"../Look\";\nimport { SOCKET_JOIN_START } from \"../Content\";\n\nexport default memo(function Room() {\n  const { uid } = useParams();\n  const {\n    lookReducer: { status, socket },\n    lookDispatch,\n  } = useContext(LookContent);\n  const RefDeskTop = useRef(null);\n  const handleInit = async () => {\n    if (!RefDeskTop.current) return;\n    lookDispatch({ type: SOCKET_JOIN_START, payload: { uid } });\n  };\n  useEffect(() => {\n    handleInit();\n  }, []);\n  return (\n    <div className={`p-8 flex`}>\n      <div className=\"relative flex-1\">\n        <video\n          ref={RefDeskTop}\n          className={`w-full bg-black ui_aspect-ratio-16/9`}\n          autoPlay\n          playsInline\n        />\n        <video\n          className={`absolute bottom-0 right-0 w-36 border m-4 ui_aspect-ratio-16/9`}\n          autoPlay\n          playsInline\n          muted\n        />\n      </div>\n      <div className=\"w-1/4 flex flex-col ml-2 border\">\n        <div className={`flex-1 overflow-auto`} />\n        <hr />\n        <div className=\"\">\n          <textarea\n            className={`resize-none p-1 h-16 w-full block`}\n            placeholder={\"say something\"}\n          />\n        </div>\n      </div>\n    </div>\n  );\n});\n","import React from \"react\";\nimport { Routes, Route } from \"react-router-dom\";\nimport Look from \"./Look\";\nimport Home from \"./Home\";\nimport Live from \"./Live\";\nimport Room from \"./Room\";\n\nconst Router = () => {\n  return (\n    <Routes>\n      <Route element={<Look />}>\n        <Route index element={<Home />} />\n        <Route path={`my`} element={<Live />} />\n        <Route path={`:uid`} element={<Room />} />\n      </Route>\n    </Routes>\n  );\n};\n\nexport default Router;\n"],"names":["socket","io","LIVE_URL","autoConnect","on","data","console","log","SOCKET_CONNECT","SOCKET_DISCONNECT","SOCKET_DESKTOP_START","SOCKET_DESKTOP_END","SOCKET_USER_START","SOCKET_USER_END","SOCKET_PUSH_START","SOCKET_PUSH_END","SOCKET_JOIN_START","LookReducer","draft","type","payload","status","connect","deskTop","user","emit","push","LookInitialState","faceDetector","LookContent","createContext","memo","useAppDispatch","useImmerReducer","lookReducer","lookDispatch","useEffect","Provider","value","Outlet","Home","list","className","map","uid","title","banner","key","Link","to","loading","src","alt","useState","useContext","DomScroll","useRef","DomObserver","useQuery","fetch","then","res","json","error","isLoading","isSuccess","ref","href","configuration","iceServers","urls","Button","onClick","children","classnames","pc","audioinput","setAudioinput","videoinput","setVideoinput","navigator","mediaDevices","enumerateDevices","deviceInfos","deviceInfo","kind","useGetInput","RefVideo","RefDeskTop","RefDeskTopStream","RefUser","RefUserStream","RefMixin","RefCtx","RefMixinCtx","RefFace","FaceDetector","RefRTC","RTCPeerConnection","addEventListener","e","target","iceCandidate","candidate","RTCIceCandidate","handleDeskTopOpen","diskTop","current","getDisplayMedia","audio","video","mediaStream","srcObject","tracks","getTracks","sender","addTrack","onended","removeTrack","handleUserOpen","getUserMedia","width","ideal","height","handleUserClose","forEach","track","stop","handlePushClose","handleSetEleSize","clientWidth","clientHeight","handleFaceDetector","requestAnimationFrame","ctx","detect","catch","faces","clearRect","beginPath","lineWidth","strokeStyle","setLineDash","face","boundingBox","strokeRect","x","y","getContext","drawImage","sdp","item","index","label","autoPlay","playsInline","onLoadedMetadata","style","transform","useParams","handleInit","muted","placeholder","Routes","Route","element","Look","path","Live","Room"],"sourceRoot":""}