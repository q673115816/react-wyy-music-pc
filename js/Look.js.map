{"version":3,"file":"js/Look.js?version=610c6bf1","mappings":"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","sources":["webpack://@wyy/web/./src/features/Look/socket.ts","webpack://@wyy/web/./src/features/Look/Content.ts","webpack://@wyy/web/./src/features/Look/Look.tsx","webpack://@wyy/web/./src/features/Look/Home/List.tsx","webpack://@wyy/web/./src/features/Look/Home/Home.tsx","webpack://@wyy/web/./src/features/Look/Live/useGetInput.tsx","webpack://@wyy/web/./src/features/Look/config.ts","webpack://@wyy/web/./src/features/Look/RTC.ts","webpack://@wyy/web/./src/features/Look/Live/Live.tsx","webpack://@wyy/web/./src/features/Look/Room/Room.tsx","webpack://@wyy/web/./src/features/Look/Router.tsx"],"sourcesContent":["import io from \"socket.io-client\";\n\nconst socket = io(LIVE_URL, {\n  autoConnect: false,\n});\n\nsocket.on(\"create-success\", (data) => {\n  console.log(\"create-success\", data);\n});\n\nsocket.on(\"create-error\", (data) => {\n  console.log(\"create-error\", data);\n});\n\nsocket.on(\"join-success\", (data) => {\n  console.log(\"join-success\", data);\n});\n\nsocket.on(\"join-info\", (data) => {\n  console.log(\"join-info\", data);\n});\n\nsocket.on(\"disconnect-success\", (data) => {\n  console.log(\"disconnect-success\", data);\n});\n\nsocket.on(\"private\", (data) => {\n  console.log(\"private\", data);\n});\n\nsocket.on(\"publish\", (data) => {\n  console.log(\"publish\", data, socket);\n});\n\nexport default socket;\n","import socket from \"./socket\";\nimport { Socket } from \"socket.io-client\";\nexport const SOCKET_CONNECT = \"SOCKET_CONNECT\";\nexport const SOCKET_DISCONNECT = \"SOCKET_DISCONNECT\";\n\nimport UAParser from \"ua-parser-js\";\n\nconsole.log(new UAParser().getResult());\n\nexport interface LookState {\n  socket: Socket;\n}\n\nexport const LookReducer = (draft: LookState, { type, payload }: any) => {\n  switch (type) {\n    case SOCKET_CONNECT:\n      socket.connect();\n      return;\n    case SOCKET_DISCONNECT:\n      socket.disconnect();\n      return;\n    default:\n      return draft;\n  }\n};\n\nexport const LookInitialState: LookState = {\n  socket,\n};\n","import React, { memo, useEffect, createContext } from \"react\";\nimport { useImmerReducer } from \"use-immer\";\nimport { Routes, Route, Outlet } from \"react-router-dom\";\nimport adapter from \"webrtc-adapter\";\nimport { useAppDispatch } from \"@/modules/hooks\";\nimport {\n  LookInitialState,\n  LookReducer,\n  SOCKET_CONNECT,\n  SOCKET_DISCONNECT,\n} from \"./Content\";\nimport getIP from \"./getIP\";\n\nexport const LookContent = createContext<any>(null);\n\nexport default memo(function Base() {\n  const dispatch = useAppDispatch();\n  const [lookReducer, lookDispatch] = useImmerReducer(\n    LookReducer,\n    LookInitialState\n  );\n  useEffect(() => {\n    lookDispatch({ type: SOCKET_CONNECT });\n    return () => {\n      lookDispatch({ type: SOCKET_DISCONNECT });\n    };\n  }, []);\n  return (\n    <LookContent.Provider value={{ lookReducer, lookDispatch }}>\n      <Outlet />\n    </LookContent.Provider>\n  );\n});\n","import React, { FC, memo } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { iHome } from \"./types\";\n\nconst Home: FC<iHome> = ({ list }) => {\n  return (\n    <div className={`grid grid-cols-3 gap-5`}>\n      {list.map(({ uid = \"\", title = \"\", banner = \"\", user = \"\" }) => (\n        <div key={uid}>\n          <Link to={uid}>\n            <img\n              className={`aspect-video cursor-pointer`}\n              loading={`lazy`}\n              src={banner}\n              alt=\"\"\n            />\n          </Link>\n          <Link to={uid} className={`cursor-pointer`}>\n            {title}\n          </Link>\n          <div>\n            <Link to={`/user/${uid}`}>{user}</Link>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default memo(Home);\n","import React, {\n  useState,\n  memo,\n  useRef,\n  useEffect,\n  useCallback,\n  MouseEventHandler,\n  useContext,\n} from \"react\";\nimport useInfinite from \"@/hooks/useInfinite\";\nimport { Link, useLocation } from \"react-router-dom\";\nimport Loading from \"@/components/Loading\";\nimport Rea from \"react-error-boundary\";\nimport socket from \"../socket\";\nimport { iList } from \"./types\";\nimport LiveList from \"./List\";\nimport { LookContent } from \"../Look\";\n\nexport default memo(function Home() {\n  const [size, setSize] = useState(20);\n  const {\n    lookReducer: { socket },\n    lookDispatch,\n  } = useContext(LookContent);\n\n  const DomScroll = useRef(null);\n  const DomObserver = useRef(null);\n  const [list, setList] = useState<iList>([]);\n  const [data, setData] = useState([]);\n  // useInfinite(() => { setSize((prev) => prev + 20); }, DomScroll, DomObserver);\n  const handleInit = async () => {\n    const { data } = await fetch(`${LIVE_URL}/list`).then((res) => res.json());\n    setData(data);\n  };\n\n  useEffect(() => {\n    handleInit();\n  }, []);\n\n  return (\n    <div className=\"domLook overflow-auto max-h-full flex-auto\" ref={DomScroll}>\n      <div className=\"domLook_header ui_header\">\n        <span className=\"title h1\">LOOK直播</span>\n        <span className=\"text-gray-400 slogan ml-2\">在这里，看见音乐</span>\n        <Link\n          to={`my`}\n          className=\"ml-2 py-1 px-2 rounded bg-red-500 text-white\"\n        >\n          我的直播\n        </Link>\n        <a href=\"https://look.163.com/hot\" className=\"text-gray-400 ml-auto\">\n          更多 &gt;\n        </a>\n      </div>\n      <div className=\"px-8\">\n        <LiveList list={data} />\n        <div ref={DomObserver} />\n      </div>\n    </div>\n  );\n});\n","import React, { useEffect, useState } from \"react\";\n\nexport interface iUseGetInput {\n  audioinput: MediaDeviceInfo[];\n  videoinput: MediaDeviceInfo[];\n}\n\nconst useGetInput = () => {\n  const [audioinput, setAudioinput] = useState<MediaDeviceInfo[]>([]);\n  const [videoinput, setVideoinput] = useState<MediaDeviceInfo[]>([]);\n  useEffect(() => {\n    (async () => {\n      const deviceInfos = await navigator.mediaDevices.enumerateDevices();\n      const audioinput = [];\n      const videoinput = [];\n      for (const deviceInfo of deviceInfos) {\n        switch (deviceInfo.kind) {\n          case \"audioinput\":\n            audioinput.push(deviceInfo);\n            break;\n          case \"videoinput\":\n            videoinput.push(deviceInfo);\n            break;\n          case \"audiooutput\":\n            console.log(\"audiooutput: \", deviceInfo);\n            break;\n          default:\n            console.log(\"default device\");\n            break;\n        }\n      }\n      setAudioinput(audioinput);\n      setVideoinput(videoinput);\n    })();\n  }, []);\n  return {\n    audioinput,\n    videoinput,\n  };\n};\n\nexport default useGetInput;\n","export const configuration: RTCConfiguration = {\n  iceServers: [\n    // {\n    //   urls: [\n    //     \"stun:stun.xten.com\",\n    //     \"stun:stun1.l.google.com:19302\",\n    //     \"stun:stun2.l.google.com:19302\",\n    //   ],\n    // },\n    {\n      urls: \"stun:stun.l.google.com:19302\",\n    },\n    {\n      urls: \"turn:192.158.29.39:3478?transport=udp\",\n      credential: \"JZEOEt2V3Qb0y27GRntt2u2PAYA=\",\n      username: \"28224511:1379330808\",\n    },\n    {\n      urls: \"turn:192.158.29.39:3478?transport=tcp\",\n      credential: \"JZEOEt2V3Qb0y27GRntt2u2PAYA=\",\n      username: \"28224511:1379330808\",\n    },\n  ],\n};\n","import { configuration } from \"./config\";\n\ninterface iRTC {\n  iceCandidateCallback: (candidate: RTCIceCandidate) => void;\n  negotiationneededCallback: (description: RTCSessionDescription) => void;\n  trackCallback: (event: RTCTrackEvent) => void;\n}\n\nexport default class {\n  pc: RTCPeerConnection;\n  // remoteStreams: MediaStream[] = [];\n  candidate: RTCIceCandidate | null = null;\n  readonly iceCandidateCallback;\n  negotiationneededCallback;\n  trackCallback;\n  id: string | null = null;\n  constructor(config: iRTC) {\n    const { iceCandidateCallback, negotiationneededCallback, trackCallback } =\n      config;\n    this.pc = new RTCPeerConnection(configuration);\n    this.iceCandidateCallback = iceCandidateCallback;\n    this.negotiationneededCallback = negotiationneededCallback;\n    this.trackCallback = trackCallback;\n    this.init();\n  }\n\n  get localDescription() {\n    return this.pc.localDescription;\n  }\n  get remoteDescription() {\n    return this.pc.remoteDescription;\n  }\n\n  get iceCandidate() {\n    return this.candidate;\n  }\n\n  init() {\n    this.pc.onicecandidate = (event) => {\n      console.log(\"pc onicecandidate\", \"id: \", this.id);\n      const { candidate } = event;\n      if (candidate) {\n        this.candidate = candidate;\n        this.iceCandidateCallback(candidate);\n        // const otherPeer;\n      }\n    };\n    this.pc.onconnectionstatechange = (event) => {\n      console.log(\"pc onconnectionstatechange\", this.pc.connectionState);\n      switch (this.pc.connectionState) {\n        case \"connected\":\n          // The connection has become fully connected\n          break;\n        case \"disconnected\":\n        case \"failed\":\n          // One or more transports has terminated unexpectedly or in an error\n          break;\n        case \"closed\":\n          // The connection has been closed\n          break;\n      }\n    };\n\n    this.pc.ondatachannel = function (event) {\n      console.log(\"Data channel is created!\");\n      event.channel.onopen = function () {\n        console.log(\"Data channel is open and ready to be used.\");\n      };\n    };\n\n    this.pc.onicecandidateerror = function (event) {\n      console.log(\"pc onicecandidateerror\");\n      if (event.errorCode >= 300 && event.errorCode <= 699) {\n        // STUN errors are in the range 300-699. See RFC 5389, section 15.6\n        // for a list of codes. TURN adds a few more error codes; see\n        // RFC 5766, section 15 for details.\n      } else if (event.errorCode >= 700 && event.errorCode <= 799) {\n        // Server could not be reached; a specific error number is\n        // provided but these are not yet specified.\n      }\n    };\n\n    this.pc.oniceconnectionstatechange = (event) => {\n      console.log(\"pc oniceconnectionstatechange\", this.pc.iceConnectionState);\n      if (\n        this.pc.iceConnectionState === \"failed\" ||\n        this.pc.iceConnectionState === \"disconnected\" ||\n        this.pc.iceConnectionState === \"closed\"\n      ) {\n        // Handle the failure\n      }\n    };\n\n    this.pc.onicegatheringstatechange = (event) => {\n      console.log(\"pc onicegatheringstatechange\", this.pc.iceGatheringState);\n      let label = \"Unknown\";\n\n      switch (this.pc.iceGatheringState) {\n        case \"new\":\n        case \"complete\":\n          label = \"Idle\";\n          break;\n        case \"gathering\":\n          label = \"Determining route\";\n          break;\n      }\n      console.log(\"label\", label);\n    };\n\n    this.pc.onnegotiationneeded = async (event) => {\n      console.log(\"pc onnegotiationneeded\");\n      try {\n        await this.pc.setLocalDescription(await this.pc.createOffer());\n        this.negotiationneededCallback(\n          this.pc.localDescription as RTCSessionDescription\n        );\n      } catch (error) {\n        console.log(\"onnegotiationneeded error \\n\", error);\n      }\n    };\n\n    this.pc.onsignalingstatechange = (event) => {\n      console.log(\"pc onsignalingstatechange\", this.pc.signalingState);\n      if (this.pc.signalingState === \"have-local-pranswer\") {\n        // setLocalDescription() has been called with an answer\n      }\n    };\n\n    this.pc.ontrack = (event) => {\n      this.trackCallback(event);\n    };\n  }\n\n  addTrack(track: MediaStreamTrack, mediaStream: MediaStream) {\n    this.pc.addTrack(track, mediaStream);\n  }\n\n  async start() {\n    try {\n      const localDescription = await this.pc.createOffer();\n      await this.pc.setLocalDescription(localDescription);\n    } catch (e) {\n      console.log(\"createOffer error \\n\", e);\n    }\n  }\n\n  async gotDescription(description: RTCSessionDescription) {\n    try {\n      await this.pc.setRemoteDescription(description);\n      await this.pc.setLocalDescription(await this.pc.createAnswer());\n    } catch (e) {\n      console.log(\"createAnswer error \\n\", e);\n    }\n  }\n\n  async gotIceCandidate(iceCandidate: RTCIceCandidate) {\n    try {\n      await this.pc.addIceCandidate(iceCandidate);\n    } catch (e) {\n      console.log(\"addIceCandidate error \\n\", e);\n    }\n  }\n}\n","import React, {\n  FC,\n  memo,\n  MouseEventHandler,\n  ReactEventHandler,\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport classnames from \"classnames\";\nimport useLoginStatus, { handleLoginStatus } from \"@/hooks/useLoginStatus\";\nimport { set, get } from \"lodash\";\nimport { LookContent } from \"@/features/Look/Look\";\nimport useGetInput, { iUseGetInput } from \"@/features/Look/Live/useGetInput\";\nimport { useImmer } from \"use-immer\";\nimport RTC from \"../RTC\";\n\ninterface iButtonProps {\n  onClick: MouseEventHandler;\n  status?: boolean;\n}\n\nconst Button: FC<iButtonProps> = ({ onClick, children, status = false }) => {\n  return (\n    <button\n      type={\"button\"}\n      className={classnames(\n        `text-white rounded px-2 h-8 flex-center`,\n        status ? \"bg-red-500\" : \"bg-blue-500\"\n      )}\n      onClick={onClick}\n    >\n      {children}\n    </button>\n  );\n};\n\ninterface iCheck<T> {\n  name: T;\n  checked: boolean;\n  onChange: (key: T) => void;\n}\n\nconst Check: FC<iCheck<initialSourceKey>> = ({\n  name,\n  children,\n  checked,\n  onChange,\n}) => {\n  return (\n    <label htmlFor={name}>\n      <input\n        type=\"checkbox\"\n        id={name}\n        name={name}\n        checked={checked}\n        onChange={() => onChange(name)}\n      />\n      {children}\n    </label>\n  );\n};\n\ninterface initialSource {\n  desktop: boolean;\n  audio: boolean;\n  video: boolean;\n  face: boolean;\n}\n\ntype initialSourceKey = keyof initialSource;\n\nconst sourceList: { key: initialSourceKey; name: string }[] = [\n  {\n    key: \"desktop\",\n    name: \"桌面\",\n  },\n  {\n    key: \"video\",\n    name: \"摄像头-画面\",\n  },\n  {\n    key: \"audio\",\n    name: \"摄像头-声音\",\n  },\n  {\n    key: \"face\",\n    name: \"摄像头-人脸识别\",\n  },\n];\n\nconst inputList: { key: keyof iUseGetInput; name: string }[] = [\n  { key: \"audioinput\", name: \"音频输入\" },\n  { key: \"videoinput\", name: \"视频输入\" },\n];\n\n/*\n * TODO\n *  1.信令系统\n *  2.摄像头叠加桌面，如基本直播\n * */\nexport default memo(function Live() {\n  const {\n    lookReducer: { socket },\n    lookDispatch,\n  } = useContext(LookContent);\n\n  const inputDevice = useGetInput();\n  const [status, setStatus] = useImmer<initialSource>({\n    desktop: false,\n    audio: false,\n    video: false,\n    face: false,\n  });\n  const RefVideo = useRef<HTMLVideoElement>(null);\n  const Refdesktop = useRef<HTMLVideoElement>(null);\n  const RefPC = useRef(\n    new RTC({\n      iceCandidateCallback(candidate) {\n        console.log(\"emit publish candidate\");\n        socket.emit(\"publish\", { to: \"337845818\", candidate });\n      },\n      negotiationneededCallback(localDescription) {\n        console.log(\"emit publish localDescription\");\n        socket.emit(\"publish\", { to: \"337845818\", localDescription });\n      },\n    })\n  );\n  const RefdesktopMixinTimer = useRef(null);\n  const RefUser = useRef<HTMLCanvasElement>(null);\n  interface iTracks {\n    [key: string]: {\n      [key: string]: Set<MediaStreamTrack>;\n    };\n  }\n  const [tracks, setTracks] = useImmer<iTracks>({\n    desktop: {},\n    user: {},\n  });\n\n  interface iStreams {\n    [key: string]: MediaStream | null;\n  }\n\n  const [streams, setStreams] = useState<iStreams>({\n    desktop: null,\n    user: null,\n    mixin: null,\n  });\n\n  const userSettings = useRef<MediaTrackSettings>();\n  const RefMixin = useRef<HTMLCanvasElement>(null);\n  const RefCtx = useRef<CanvasRenderingContext2D>(null);\n  const RefMixinCtx = useRef<CanvasRenderingContext2D>(null);\n  const RefFace = useRef(new FaceDetector());\n\n  const handledesktopClose = () => {\n    const diskTop = Refdesktop.current as HTMLVideoElement;\n    const tracks = (diskTop.srcObject as MediaStream).getTracks();\n    tracks.forEach((track) => track.stop());\n    diskTop.srcObject = null;\n  };\n\n  const handlePushClose = () => {\n    socket.emit(\"close\", {\n      detail: {\n        uid: \"337845818\",\n      },\n    });\n  };\n\n  // useEffect(() => handlePushClose, []);\n\n  const handleSetEleSize =\n    ({\n      current: ref,\n    }: {\n      current: HTMLCanvasElement;\n    }): ReactEventHandler<HTMLVideoElement> =>\n    ({ target }) => {\n      const width = target.clientWidth;\n      const height = target.clientHeight;\n      ref.width = width;\n      ref.height = height;\n    };\n\n  const handleFaceDetector = async () => {\n    requestAnimationFrame(handleFaceDetector);\n    const user = RefUser.current as HTMLCanvasElement;\n    const ctx = RefCtx.current as CanvasRenderingContext2D;\n    const { width, height } = user;\n    const faces = await RefFace.current\n      .detect(RefVideo.current)\n      .catch((e: any) => console.log(e));\n    ctx.clearRect(0, 0, width, height);\n    ctx.beginPath();\n    ctx.lineWidth = 3;\n    ctx.strokeStyle = \"lime\";\n    ctx.setLineDash([5]);\n    for (const { boundingBox: face } of faces) {\n      ctx.strokeRect(face.x, face.y, face.width, face.height);\n    }\n  };\n  useEffect(() => {\n    RefCtx.current = (RefUser.current as HTMLCanvasElement).getContext(\"2d\");\n  }, [RefUser]);\n  useEffect(() => {\n    RefMixinCtx.current = (RefMixin.current as HTMLCanvasElement).getContext(\n      \"2d\"\n    );\n  }, [RefMixin]);\n\n  const handleMixindesktop = () => {\n    if (!streams.desktop) return;\n    const { width, height } = RefMixin.current as HTMLCanvasElement;\n    // console.log(\"mixin desktop \");\n    requestAnimationFrame(handleMixindesktop);\n    RefMixinCtx.current.drawImage(Refdesktop.current, 0, 0, width, height);\n  };\n\n  const handleMixinUser = () => {\n    if (!streams.user) return;\n    // console.log(\"mixin user \");\n    requestAnimationFrame(handleMixinUser);\n    const ctx = RefMixinCtx.current as CanvasRenderingContext2D;\n    const eleVideo = RefVideo.current as HTMLVideoElement;\n    ctx.save();\n    ctx.scale(-1, 1);\n    const width = 200;\n    ctx.drawImage(\n      eleVideo,\n      0,\n      0,\n      -width,\n      width / userSettings.current.aspectRatio\n    );\n    ctx.restore();\n  };\n\n  useEffect(() => {\n    console.log(\"streams desktop effect\");\n    handleMixindesktop();\n  }, [streams.desktop]);\n  useEffect(() => {\n    console.log(\"streams user effect\");\n    handleMixinUser();\n  }, [streams.user]);\n\n  // useEffect(() => {\n  //   console.log(size);\n  //   RefMixin.current.width = size.width;\n  //   RefMixin.current.height = size.height;\n  // }, [size]);\n\n  const handleSetTrack = (track: MediaStreamTrack, name: string) => {\n    const { kind } = track;\n    setTracks((draft) => {\n      draft[name][kind] ??= new Set();\n      draft[name][kind].add(track);\n    });\n  };\n\n  const handleDesktopCapture = async () => {\n    const diskTop = Refdesktop.current as HTMLVideoElement;\n    try {\n      const mediaStream = await navigator.mediaDevices.getDisplayMedia({\n        audio: true,\n        video: true,\n      });\n      setStreams((prev) => ({ ...prev, desktop: mediaStream }));\n      // RefdesktopStream.current = mediaStream;\n      diskTop.srcObject = mediaStream;\n      // for (const track of mediaStream.getVideoTracks()) {\n      //   const { width = 0, height = 0 } = track.getSettings();\n      //   setSize({ width, height });\n      // }\n      const tracks = mediaStream.getTracks();\n      for (const track of tracks) {\n        handleSetTrack(track, \"desktop\");\n        RefPC.current.addTrack(track, mediaStream);\n      }\n      tracks[0].onended = () => {\n        // RefRTC.current.removeTrack(sender);\n      };\n    } catch (e) {\n      console.log(\"桌面捕捉\", e);\n    }\n  };\n\n  const handleUserCapture = () => {\n    const video = RefVideo.current as HTMLVideoElement;\n    navigator.mediaDevices\n      .getUserMedia({\n        // audio: true,\n        video: {\n          width: { ideal: 1280 },\n          height: { ideal: 720 },\n        },\n      })\n      .then((mediaStream) => {\n        setStreams((prev) => ({ ...prev, user: mediaStream }));\n        for (const track of mediaStream.getVideoTracks()) {\n          const settings = track.getSettings();\n          console.log(settings);\n          userSettings.current = settings;\n        }\n        video.srcObject = mediaStream;\n      })\n      .catch((e) => {\n        console.log(\"摄像头捕获\", e);\n      });\n  };\n\n  const handleCapture = async () => {\n    await RefPC.current.start();\n    socket.emit(\"create\", {\n      detail: {\n        title: \"6666\",\n        user: \"337845818\",\n        uid: \"337845818\",\n        banner:\n          \"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.jj20.com%2Fup%2Fallimg%2Ftp03%2F1Z9211616415M2-0-lp.jpg&refer=http%3A%2F%2Fimg.jj20.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1642140129&t=1cd7e5653b612ffbe71c1f461c5cb387\",\n      },\n    });\n    handleDesktopCapture();\n    // handleUserCapture();\n    // const mediaStream = (RefMixin.current as HTMLCanvasElement).captureStream(\n    //   30\n    // );\n    // setStreams((prev) => ({ ...prev, canvas: mediaStream }));\n    // console.log(mediaStream);\n  };\n\n  const handleSend = async () => {\n    // for (const kind in tracks.desktop) {\n    //   for(const track of tracks.desktop[kind]) {\n    //     RefPC.current.addtrack({track, });\n    //   }\n    // }\n    await RefPC.current.start();\n    socket.emit(\"create\", {\n      detail: {\n        title: \"6666\",\n        user: \"337845818\",\n        uid: \"337845818\",\n        banner:\n          \"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.jj20.com%2Fup%2Fallimg%2Ftp03%2F1Z9211616415M2-0-lp.jpg&refer=http%3A%2F%2Fimg.jj20.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1642140129&t=1cd7e5653b612ffbe71c1f461c5cb387\",\n      },\n    });\n  };\n\n  const joinSuccessCallback = async (data: any) => {\n    await RefPC.current.gotIceCandidate(data.description);\n    socket.emit(\"private\", {\n      to: data.from,\n      description: RefPC.current.localDescription,\n    });\n  };\n\n  const privateCallback = (data: any) => {\n    if (data.description) RefPC.current.gotDescription(data.description);\n    if (data.iceCandidate) RefPC.current.gotIceCandidate(data.iceCandidate);\n  };\n\n  useEffect(() => {\n    socket.on(\"join-success\", joinSuccessCallback);\n    socket.on(\"private\", privateCallback);\n    return () => {\n      socket.off(\"join-success\", joinSuccessCallback);\n      socket.off(\"private\", joinSuccessCallback);\n    };\n  }, []);\n\n  const handleChangeStatus = useCallback((key: initialSourceKey) => {\n    setStatus((draft) => {\n      const value = get(draft, key);\n      set(draft, key, !value);\n      // draft[key] = !draft[key];\n    });\n  }, []);\n  return (\n    <div className={`w-full h-full p-8 overflow-auto`}>\n      <div className={`flex`}>\n        <Button onClick={handleCapture}>开始捕获并推送</Button>\n        {/*<Button onClick={handleSend}>推送</Button>*/}\n        <div className={`border ml-auto`}>\n          <div className={`flex flex-col flex-wrap`}>\n            {sourceList.map(({ key, name }) => (\n              <Check\n                key={key}\n                name={key}\n                onChange={handleChangeStatus}\n                checked={status[key]}\n              >\n                <span>{name}</span>\n              </Check>\n            ))}\n            {inputList.map(({ key, name }) => (\n              <div key={key}>\n                <span>{name}</span>\n                <select className={`border`} disabled>\n                  {inputDevice[key].map((item, index) => {\n                    return (\n                      <option value=\"\" key={index}>\n                        {item.label}\n                      </option>\n                    );\n                  })}\n                </select>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n      <div className={`flex flex-col`}>\n        <div className={``}>\n          <video\n            className={`w-full`}\n            ref={Refdesktop}\n            autoPlay\n            playsInline\n            onLoadedMetadata={handleSetEleSize(RefMixin)}\n          />\n        </div>\n        <hr />\n        <div className={\"relative\"}>\n          <video\n            className={`w-full`}\n            ref={RefVideo}\n            autoPlay\n            playsInline\n            style={{ transform: `scale(-1, 1)` }}\n            onLoadedMetadata={handleSetEleSize(RefUser)}\n          />\n          <canvas\n            className={`absolute inset-0 w-full h-full`}\n            style={{ transform: `scale(-1, 1)` }}\n            ref={RefUser}\n          />\n        </div>\n      </div>\n      <hr />\n      <div>\n        <canvas className=\"w-full\" ref={RefMixin} />\n      </div>\n    </div>\n  );\n});\n","import React, { memo, useContext, useEffect, useRef } from \"react\";\nimport { useParams } from \"react-router-dom\";\nimport { LookContent } from \"../Look\";\nimport RTC from \"../RTC\";\n\nexport default memo(function Room() {\n  const { uid } = useParams();\n  const {\n    lookReducer: { socket },\n    lookDispatch,\n  } = useContext(LookContent);\n\n  const RefStream = useRef<MediaStream>(new MediaStream());\n  const RefVideo = useRef<HTMLVideoElement>(null);\n  const RefPC = useRef(\n    new RTC({\n      iceCandidateCallback(iceCandidate) {\n        socket.emit(\"private\", { to: RefPC.current.id, iceCandidate });\n      },\n      negotiationneededCallback(description) {\n        console.log(\"重发 description\");\n        socket.emit(\"private\", { to: RefPC.current.id, description });\n      },\n      trackCallback(event) {\n        console.log(\"get track\", event);\n        RefVideo.current.srcObject = event.streams[0];\n      },\n    })\n  );\n\n  const successCallback = (data: any) => {\n    if (data.from) RefPC.current.id = data.from;\n    if (data.description) RefPC.current.gotDescription(data.description);\n    if (data.iceCandidate) RefPC.current.gotIceCandidate(data.iceCandidate);\n  };\n\n  useEffect(() => {\n    socket.on(\"private\", successCallback);\n    socket.on(\"publish\", successCallback);\n    socket.emit(\"join\", {\n      detail: { uid },\n    });\n    return () => {\n      socket.off(\"join-success\", successCallback);\n    };\n  }, []);\n  return (\n    <div className={`p-8 flex`}>\n      <div className=\"relative flex-1\">\n        <video ref={RefVideo} className={`w-full`} autoPlay playsInline />\n      </div>\n      <div className=\"w-1/4 flex flex-col ml-2 border\">\n        <div className={`flex-1 overflow-auto`} />\n        <hr />\n        <div className=\"\">\n          <textarea\n            className={`resize-none p-1 h-16 w-full block`}\n            placeholder={\"say something\"}\n          />\n        </div>\n      </div>\n    </div>\n  );\n});\n","import React from \"react\";\nimport { Routes, Route } from \"react-router-dom\";\nimport Look from \"./Look\";\nimport Home from \"./Home\";\nimport Live from \"./Live\";\nimport Room from \"./Room\";\n\nconst Router = () => {\n  return (\n    <Routes>\n      <Route element={<Look />}>\n        <Route index element={<Home />} />\n        <Route path={`my`} element={<Live />} />\n        <Route path={`:uid`} element={<Room />} />\n      </Route>\n    </Routes>\n  );\n};\n\nexport default Router;\n"],"names":["socket","io","LIVE_URL","autoConnect","on","data","console","log","SOCKET_CONNECT","SOCKET_DISCONNECT","UAParser","getResult","LookReducer","draft","type","payload","LookInitialState","LookContent","createContext","memo","useAppDispatch","useImmerReducer","lookReducer","lookDispatch","useEffect","Provider","value","Outlet","Home","list","div","className","map","uid","title","banner","user","key","Link","to","img","loading","src","alt","useState","useContext","DomScroll","useRef","DomObserver","setData","handleInit","fetch","then","res","json","ref","span","a","href","LiveList","configuration","iceServers","urls","credential","username","kind","config","candidate","id","iceCandidateCallback","negotiationneededCallback","trackCallback","this","pc","RTCPeerConnection","init","onicecandidate","event","onconnectionstatechange","connectionState","ondatachannel","channel","onopen","onicecandidateerror","errorCode","oniceconnectionstatechange","iceConnectionState","onicegatheringstatechange","iceGatheringState","label","onnegotiationneeded","createOffer","setLocalDescription","localDescription","onsignalingstatechange","signalingState","ontrack","addTrack","track","mediaStream","start","gotDescription","description","setRemoteDescription","createAnswer","gotIceCandidate","iceCandidate","addIceCandidate","remoteDescription","Button","onClick","children","status","button","classnames","Check","name","checked","onChange","htmlFor","input","sourceList","inputList","inputDevice","audioinput","setAudioinput","videoinput","setVideoinput","deviceInfos","deviceInfo","navigator","mediaDevices","enumerateDevices","push","useGetInput","useImmer","desktop","audio","video","face","setStatus","RefVideo","Refdesktop","RefPC","RTC","emit","RefUser","setTracks","mixin","streams","setStreams","userSettings","RefMixin","RefCtx","RefMixinCtx","RefFace","FaceDetector","handleSetEleSize","current","target","width","clientWidth","height","clientHeight","handleFaceDetector","ctx","faces","requestAnimationFrame","detect","catch","e","clearRect","beginPath","lineWidth","strokeStyle","setLineDash","boundingBox","strokeRect","x","y","getContext","handleMixindesktop","drawImage","handleMixinUser","eleVideo","save","scale","aspectRatio","restore","handleSetTrack","Set","add","handleDesktopCapture","diskTop","tracks","getDisplayMedia","prev","srcObject","getTracks","onended","handleCapture","detail","joinSuccessCallback","from","privateCallback","off","handleChangeStatus","useCallback","get","set","select","disabled","item","index","option","autoPlay","playsInline","onLoadedMetadata","hr","style","transform","canvas","useParams","MediaStream","successCallback","textarea","placeholder","Routes","Route","element","Look","path","Live","Room"],"sourceRoot":""}