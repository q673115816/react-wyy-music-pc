"use strict";(this.webpackChunkwyy=this.webpackChunkwyy||[]).push([[113],{1023:(e,t,n)=>{n.r(t),n.d(t,{default:()=>j});var a=n(7363),c=n.n(a),r=n(6711),s=n(5861),o=n(885),u=n(7757),l=n.n(u),i=n(57),m=n(9638),d=n(2924),f=n.n(d)()("https://enigmatic-forest-38434.herokuapp.com",{autoConnect:!1});f.on("create-success",(function(e){console.log(e)})),f.on("join-success",(function(e){console.log(e)})),f.on("disconnect-success",(function(e){console.log(e)}));const p=f;var E="SOCKET_DESKTOP_START",v="SOCKET_DESKTOP_END",h="SOCKET_USER_START",k="SOCKET_USER_END",g="SOCKET_PUSH_START",C="SOCKET_PUSH_END",y=function(e,t){switch(t.type){case"SOCKET_CONNECT":return p.connect(),void(e.status.connect=!0);case"SOCKET_DISCONNECT":return p.disconnect(),void(e.status.connect=!1);case E:return void(e.status.deskTop=!0);case v:return void(e.status.deskTop=!1);case h:return void(e.status.user=!0);case k:return void(e.status.user=!1);case g:return p.emit("create",{user:"user",title:"title"}),void(e.status.push=!0);case C:return void(e.status.push=!1);default:return e}},N={status:{connect:!1,deskTop:!1,user:!1,push:!1,faceDetector:!1}};n(4916),n(4723),n(1539),n(4747),n(3123),n(2772);const T=function(){var e=(0,s.Z)(l().mark((function e(t){var n,a,c,r,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},a=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/,c=new RTCPeerConnection({iceServers:[{urls:"stun:stun.xten.com"}]}),r=function(e){console.log(e);var t=e.match(a);t&&t.forEach((function(e){console.log(e),n[e]=!0}))},c.createDataChannel(""),c.onicecandidate=function(e){console.log("ice:",e),e.candidate&&r(e.candidate.candidate)},e.next=9,c.createOffer();case 9:return s=e.sent,e.next=12,c.setLocalDescription(s);case 12:c.localDescription.sdp.split("\n").forEach((function(e){0===e.indexOf("a=candidate:")&&r(e)})),console.log();case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var x=(0,a.createContext)(null);const w=(0,a.memo)((function(){(0,m.T)();var e=(0,i.C)(y,N),t=(0,o.Z)(e,2),n=t[0],u=t[1];return(0,a.useEffect)((function(){(0,s.Z)(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T();case 2:case"end":return e.stop()}}),e)})))()}),[]),c().createElement(x.Provider,{value:{lookReducer:n,lookDispatch:u}},c().createElement(r.Outlet,null))}));var R=n(7467),S=n.n(R),O=n(7453),D=n(8157);n(1249),n(2222);const _=(0,a.memo)((function(e){var t=e.list,n=(0,r.useLocation)().pathname;return c().createElement("div",{className:"grid grid-cols-3 gap-5"},t.map((function(e){var t=(0,o.Z)(e,2),a=t[0],s=t[1];return c().createElement("div",{key:a},c().createElement(r.Link,{to:"".concat(n,"/").concat(a)},c().createElement("img",{className:"ui_aspect-ratio-16/9 cursor-pointer",loading:"lazy",src:s.banner,alt:""})),c().createElement(r.Link,{to:"".concat(n,"/").concat(a),className:"cursor-pointer"},s.title),c().createElement("div",null,c().createElement(r.Link,{to:"/"},s.user)))})))})),b=(0,a.memo)((function(){var e=(0,a.useState)(20),t=(0,o.Z)(e,2),n=(t[0],t[1],(0,a.useRef)(null)),u=(0,a.useRef)(null),i=(0,a.useState)([]),m=(0,o.Z)(i,2),d=(m[0],m[1],(0,O.useQuery)("look",(0,s.Z)(l().mark((function e(){var t,n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S().get("".concat("https://enigmatic-forest-38434.herokuapp.com","/list")).then((function(e){return e.data}));case 2:return t=e.sent,n=t.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)}))))),f=d.data,p=(d.error,d.isLoading),E=d.isSuccess;return d.status,c().createElement("div",{className:"domLook overflow-auto max-h-full flex-auto",ref:n},c().createElement("div",{className:"domLook_header ui_header"},c().createElement("span",{className:"title h1"},"LOOK直播"),c().createElement("span",{className:"text-gray-400 slogan ml-2"},"在这里，看见音乐"),c().createElement(r.Link,{to:"my",className:"ml-2 py-1 px-2 rounded bg-red-500 text-white"},"我的直播"),c().createElement("a",{href:"https://look.163.com/hot",className:"text-gray-400 ml-auto"},"更多 >")),c().createElement("div",{className:"px-8"},p&&c().createElement("div",{className:"pt-48 flex-center"},c().createElement(D.Z,null)),E&&c().createElement(_,{list:f}),c().createElement("div",{ref:u})))}));var K=n(4184),L=n.n(K),P=function(e){var t=e.onClick,n=e.children,a=e.status;return c().createElement("button",{type:"button",className:L()("text-white rounded p-2",a?"bg-red-500":"bg-blue-500"),onClick:t},n)};const Z=(0,a.memo)((function(){var e,t=(0,a.useContext)(x),n=t.lookReducer,r=n.status,s=(n.socket,t.lookDispatch),u=(0,a.useState)((function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)})),l=((0,o.Z)(u,1)[0],(0,a.useRef)(((e=document.createElement("video")).autoplay=!0,e))),i=(0,a.useRef)(null),m=((0,a.useRef)(null),(0,a.useRef)(null)),d=(0,a.useRef)(null),f=((0,a.useRef)(new FaceDetector),function(e,t,n){navigator.mediaDevices[t]({video:{width:{ideal:1280},height:{ideal:720}},audio:!0}).then((function(t){e.srcObject=t,n&&n()})).catch((function(e){return console.log(e)}))}),p=function(e,t){var n;(null===(n=e.srcObject)||void 0===n?void 0:n.getTracks()).forEach((function(e){return e.stop()})),e.srcObject=null,t&&t()};return(0,a.useEffect)((function(){d.current=m.current.getContext("2d")}),[m]),c().createElement("div",{className:"w-full h-full p-8 overflow-auto"},c().createElement("div",{className:"flex"},c().createElement(P,{onClick:function(){r.deskTop?p(i.current,(function(){s({type:v})})):f(i.current,"getDisplayMedia",(function(){s({type:E})}))},status:r.deskTop},"桌面共享开关"),c().createElement(P,{onClick:function(){r.user?p(l.current,(function(){s({type:k})})):f(l.current,"getUserMedia",(function(){s({type:h})}))},status:r.user},"摄像头开关"),c().createElement(P,{onClick:function(){},status:r.faceDetector},"人脸识别"),c().createElement(P,{onClick:function(){r.push?s({type:C}):(s({type:g}),new RTCPeerConnection({}).addEventListener("icecandidate",(function(e){e.target;var t=e.candidate;t&&new RTCIceCandidate(t)})))},status:r.push},"推送开关")),c().createElement("div",{className:"flex flex-col"},c().createElement("div",{className:""},c().createElement("video",{className:"w-full",ref:i,autoPlay:!0,playsInline:!0})),c().createElement("div",{className:""},c().createElement("canvas",{className:"w-full",ref:m,style:{transform:"scale(-1, 1)"}}))))})),U=(0,a.memo)((function(){return(0,r.useParams)().id,c().createElement("div",{className:"p-8"},c().createElement("video",{className:"w-full",autoPlay:!0,playsInline:!0}))})),j=function(){return c().createElement(r.Routes,null,c().createElement(r.Route,{element:c().createElement(w,null)},c().createElement(r.Route,{index:!0,element:c().createElement(b,null)}),c().createElement(r.Route,{path:"my",element:c().createElement(Z,null)}),c().createElement(r.Route,{path:":id",element:c().createElement(U,null)})))}}}]);
//# sourceMappingURL=Look.js.map?version=c2742009