{"version":3,"file":"js/Comment.js?version=c572d25d","mappings":"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","sources":["webpack://@wyy/web/./src/features/Comment/Hot.tsx","webpack://@wyy/web/./src/features/Comment/Comment.tsx","webpack://@wyy/web/./src/features/Comment/Router.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef, memo } from \"react\";\nimport { apiCommentHot, apiCommentLike } from \"@/api\";\nimport Comment from \"@/components/Comments/Comment\";\nimport useInfinite from \"@/hooks/useInfinite\";\nimport Loading from \"@/components/Loading\";\nimport produce from \"immer\";\nimport { useParams } from \"react-router-dom\";\n\nexport default memo(function Hot() {\n  const { id } = useParams();\n  const [data, setData] = useState([]);\n  const refHasMore = useRef(true);\n  const offset = useRef(0);\n  const domObserver = useRef(null);\n  const domScroll = useRef(null);\n  const limit = 20;\n\n  const handleLike = async (cid, t) => {\n    try {\n      const { code } = await apiCommentLike({\n        id,\n        cid,\n        t: t ? 0 : 1,\n        type: 0,\n      });\n      if (code === 200) {\n        setData(\n          produce((draft) => {\n            draft.forEach((item) => {\n              if (item.commentId === cid) {\n                item.liked = !t;\n                item.likedCount += t ? -1 : 1;\n              }\n            });\n          })\n        );\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const handleInit = async () => {\n    if (!refHasMore.current) return false;\n    try {\n      const { hotComments, hasMore } = await apiCommentHot({\n        id,\n        type: 0,\n        limit,\n        offset: offset.current,\n      });\n      refHasMore.current = hasMore;\n\n      offset.current += limit;\n      // const a = [...data, ...hotComments];\n      // console.log(data.concat(hotComments));\n      setData((data) => [...data, ...hotComments]);\n      // console.log(data); data 只能拿到空数组\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  useInfinite(handleInit, domScroll, domObserver);\n\n  // if (loading) return <div>loading</div>;\n  return (\n    <div\n      className=\"domComment px-8 py-5 overflow-auto max-h-full flex-auto\"\n      ref={domScroll}\n    >\n      <div className=\"h1\">精彩评论</div>\n      <div className=\"domComment_list\">\n        {data.map((item) => (\n          <Comment\n            item={item}\n            // handleLike={handleLike}\n            key={item.commentId}\n          />\n        ))}\n        {refHasMore.current && (\n          <div className=\"flex justify-center py-4\">\n            <Loading />\n          </div>\n        )}\n        <div ref={domObserver} />\n      </div>\n    </div>\n  );\n});\n","import React, { memo, useEffect, useState, useMemo, useCallback } from \"react\";\nimport { Link, useParams } from \"react-router-dom\";\nimport { IconPlayerPlay, IconMoodSmile, IconAt, IconHash } from \"@tabler/icons\";\nimport {\n  apiCommentMusic,\n  apiSongDetail,\n  apiCommentMV,\n  apiMVDetail,\n  apiCommentVideo,\n  apiVideoDetail,\n} from \"@/api\";\nimport { commentLimit as limit } from \"@/common/config\";\nimport Write from \"@/components/Write\";\nimport CommentsList from \"@/components/Comments/CommentsList\";\nimport Loading from \"@/components/Loading\";\nimport Page from \"@/components/Page\";\n\nconst SongHeader = ({ detail }) => (\n  <div className=\"domComment_header\">\n    <div className=\"domComment_infos flex \">\n      <div className=\"cover h-20 rounded overflow-hidden relative\">\n        <img\n          loading={\"lazy\"}\n          className=\"h-full\"\n          src={detail.al.picUrl}\n          alt=\"\"\n        />\n        <div className=\"ico absolute inset-0 m-auto flex-center w-8 h-8 ui_themeColor rounded-full bg-white bg-opacity-90\">\n          <IconPlayerPlay size={16} className=\"fill-current\" />\n        </div>\n      </div>\n      <div className=\"content px-6 py-2\">\n        <div className=\"title text-lg\">\n          {detail.name}\n          <span className={\"text-gray-500\"}>\n            {detail.alia.length > 0 && `(${detail.alia})`}\n          </span>\n        </div>\n        <div className=\"info text-gray-500 mt-2 space-x-5\">\n          <span>\n            专辑：\n            <Link\n              className=\"ui_text_gray_hover\"\n              to={`/playlist/album/${detail.al.id}`}\n            >\n              {detail.al?.name}\n            </Link>\n          </span>\n          <span>\n            歌手：\n            {detail.ar.map((item, index) => (\n              <span key={item.id}>\n                {index > 0 && \" / \"}\n                <Link className=\"ui_text_gray_hover\" to={`/artist/${item.id}`}>\n                  {item.name}\n                </Link>\n              </span>\n            ))}\n          </span>\n        </div>\n      </div>\n    </div>\n  </div>\n);\n\nconst switchs = {\n  song: {\n    apiDetail: ({ id }) => apiSongDetail({ ids: id }),\n    apiComment: apiCommentMusic,\n    header: SongHeader,\n  },\n  mv: {\n    apiDetail: apiMVDetail,\n    apiComment: apiCommentMV,\n    header: () => <div />,\n  },\n  video: {\n    apiDetail: apiVideoDetail,\n    apiComment: apiCommentVideo,\n    header: () => <div />,\n  },\n};\n\nexport default memo(function Comment() {\n  console.log(\"comment\");\n  const { id, type } = useParams();\n  const [detail, setDetail] = useState({});\n  const [comments, setComments] = useState({});\n  const [value, setValue] = useState(\"\");\n  const [loading, SetLoading] = useState(true);\n  const [page, setPage] = useState(1);\n  const handleDetailInit = async () => {\n    try {\n      const { songs } = await switchs[type].apiDetail({\n        id,\n      });\n      setDetail(songs[0]);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const handleChange = useCallback((e) => {\n    setValue(e.target.value);\n  }, []);\n\n  const handleCommentsInit = async () => {\n    try {\n      const comments = await switchs[type].apiComment({\n        id,\n        offset: (page - 1) * 20,\n        limit,\n      });\n      setComments(comments);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n  const handleInit = async () => {\n    await handleDetailInit();\n    await handleCommentsInit();\n    SetLoading(false);\n  };\n\n  const MemoHeader = useMemo(() => switchs[type].header, [type]);\n\n  useEffect(() => {\n    if (loading) {\n      handleInit();\n    } else {\n      handleCommentsInit();\n    }\n  }, [page]);\n\n  if (loading)\n    return (\n      <div className=\"w-full h-full flex-center\">\n        <Loading />\n      </div>\n    );\n  return (\n    <div className=\"domComment overflow-auto px-8 py-5 h-full\">\n      <MemoHeader detail={detail} />\n      <div className=\"domComment_write mt-4\">\n        <Write onChange={handleChange} max={140} />\n        <div className=\"domComment_write_actions flex mt-2.5\">\n          <div className=\"flex space-x-2\">\n            <button type=\"button\" className=\"text-gray-500 hover:text-black\">\n              <IconMoodSmile size={20} stroke={1.5} />\n            </button>\n            <button type=\"button\" className=\"text-gray-500 hover:text-black\">\n              <IconAt size={20} stroke={1.5} />\n            </button>\n            <button type=\"button\" className=\"text-gray-500 hover:text-black\">\n              <IconHash size={20} stroke={1.5} />\n            </button>\n          </div>\n          <button\n            type=\"button\"\n            className=\"ui_btn flex-center border px-4 h-8 text-sm hover:bg-gray-100 rounded-full ml-auto\"\n          >\n            评论\n          </button>\n        </div>\n      </div>\n      <div className=\"domComment_main mt-8\">\n        <CommentsList comments={comments} more={id} type={type} />\n        <Page\n          total={Math.ceil(comments.total / limit)}\n          page={page}\n          func={setPage}\n        />\n      </div>\n    </div>\n  );\n});\n","import React from \"react\";\nimport { Routes, Route } from \"react-router-dom\";\nimport Hot from \"./Hot\";\nimport Comment from \"./Comment\";\n\nconst Router = () => {\n  return (\n    <Routes>\n      <Route path={`:type/:id`}>\n        <Route index element={<Comment />} />\n        <Route path=\"hot\" element={<Hot />} />\n      </Route>\n    </Routes>\n  );\n};\n\nexport default Router;\n"],"names":["memo","useParams","id","useState","data","setData","refHasMore","useRef","offset","domObserver","domScroll","handleInit","cid","t","apiCommentLike","type","code","produce","draft","forEach","item","commentId","liked","likedCount","console","log","hotComments","hasMore","current","apiCommentHot","limit","useInfinite","div","className","ref","map","Comment","key","Loading","switchs","song","apiDetail","apiSongDetail","ids","apiComment","apiCommentMusic","header","detail","img","loading","src","al","picUrl","alt","IconPlayerPlay","size","name","span","alia","length","Link","to","ar","index","mv","apiMVDetail","apiCommentMV","video","apiVideoDetail","apiCommentVideo","setDetail","comments","setComments","setValue","SetLoading","page","setPage","handleDetailInit","songs","handleChange","useCallback","e","target","value","handleCommentsInit","MemoHeader","useMemo","useEffect","Write","onChange","max","button","IconMoodSmile","stroke","IconAt","IconHash","CommentsList","more","Page","total","Math","ceil","func","Routes","Route","path","element","Hot"],"sourceRoot":""}