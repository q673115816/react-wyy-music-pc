"use strict";(this.webpackChunkwyy=this.webpackChunkwyy||[]).push([[456],{1458:(e,t,n)=>{n.r(t),n.d(t,{default:()=>R});var r=n(7363),a=n.n(r),o=n(6711),l=n(5666),c=n.n(l),u=n(9266),i=n(834),s=n(534),m=n(4719),f=n(7980),d=n.n(f);function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function v(e,t,n,r,a,o,l){try{var c=e[o](l),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,a)}function y(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function l(e){v(o,r,a,l,c,"next",e)}function c(e){v(o,r,a,l,c,"throw",e)}l(void 0)}))}}function h(e){return function(e){if(Array.isArray(e))return p(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||b(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}const E=(0,r.memo)((function(){var e,t,n=(0,o.useParams)().id,l=(e=(0,r.useState)([]),t=2,function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],l=!0,c=!1;try{for(n=n.call(e);!(l=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{l||null==n.return||n.return()}finally{if(c)throw a}}return o}}(e,t)||b(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),f=l[0],p=l[1],v=(0,r.useRef)(!0),E=(0,r.useRef)(0),x=(0,r.useRef)(null),w=(0,r.useRef)(null),g=(y(c().mark((function e(t,r){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,u.W3)({id:n,cid:t,t:r?0:1,type:0});case 3:200===e.sent.code&&p(d()((function(e){e.forEach((function(e){e.commentId===t&&(e.liked=!r,e.likedCount+=r?-1:1)}))}))),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),function(){var e=y(c().mark((function e(){var t,r,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v.current){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,e.next=5,(0,u.jH)({id:n,type:0,limit:20,offset:E.current});case 5:t=e.sent,r=t.hotComments,a=t.hasMore,v.current=a,E.current+=20,p((function(e){return h(e).concat(h(r))})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[2,13]])})));return function(){return e.apply(this,arguments)}}());return(0,s.Z)(g,w,x),a().createElement("div",{className:"domComment px-8 py-5 overflow-auto max-h-full flex-auto",ref:w},a().createElement("div",{className:"h1"},"精彩评论"),a().createElement("div",{className:"domComment_list"},f.map((function(e){return a().createElement(i.Z,{item:e,key:e.commentId})})),v.current&&a().createElement("div",{className:"flex justify-center py-4"},a().createElement(m.Z,null)),a().createElement("div",{ref:x})))}));var x=n(6719),w=n(727),g=n(5170),k=n(5986),N=n(3912);function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function S(e,t,n,r,a,o,l){try{var c=e[o](l),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,a)}function A(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function l(e){S(o,r,a,l,c,"next",e)}function c(e){S(o,r,a,l,c,"throw",e)}l(void 0)}))}}function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],l=!0,c=!1;try{for(n=n.call(e);!(l=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{l||null==n.return||n.return()}finally{if(c)throw a}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var I={song:{apiDetail:function(e){var t=e.id;return(0,u.VO)({ids:t})},apiComment:u.dV,header:function(e){var t,n=e.detail;return a().createElement("div",{className:"domComment_header"},a().createElement("div",{className:"domComment_infos flex "},a().createElement("div",{className:"cover h-20 rounded overflow-hidden relative"},a().createElement("img",{loading:"lazy",className:"h-full",src:n.al.picUrl,alt:""}),a().createElement("div",{className:"ico absolute inset-0 m-auto flex-center w-8 h-8 ui_themeColor rounded-full bg-white bg-opacity-90"},a().createElement(x.IconPlayerPlay,{size:16,className:"fill-current"}))),a().createElement("div",{className:"content px-6 py-2"},a().createElement("div",{className:"title text-lg"},n.name),a().createElement("div",{className:"info text-gray-500 mt-2 space-x-5"},a().createElement("span",null,"专辑：",a().createElement(o.Link,{className:"ui_text_gray_hover",to:"/playlist/album/".concat(n.al.id)},null===(t=n.al)||void 0===t?void 0:t.name)),a().createElement("span",null,"歌手：",n.ar.map((function(e,t){return a().createElement("span",{key:e.id},t>0&&" / ",a().createElement(o.Link,{className:"ui_text_gray_hover",to:"/artist/".concat(e.id)},e.name))})))))))}},mv:{apiDetail:u.Ro,apiComment:u.L,header:function(){return a().createElement("div",null)}},video:{apiDetail:u.ld,apiComment:u.ju,header:function(){return a().createElement("div",null)}}};const j=(0,r.memo)((function(){console.log("comment");var e,t=(0,o.useParams)(),n=t.id,l=t.type,u=_((0,r.useState)({}),2),i=u[0],s=u[1],f=_((0,r.useState)({}),2),d=f[0],p=f[1],v=_((0,r.useState)(""),2),y=(v[0],v[1]),h=_((0,r.useState)(!0),2),b=h[0],E=h[1],C=_((0,r.useState)(1),2),S=C[0],j=C[1],R=(e=A(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I[l].apiDetail({id:n});case 3:t=e.sent.songs,s(t[0]),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),function(){return e.apply(this,arguments)}),P=(0,r.useCallback)((function(e){y(e.target.value)}),[]),Z=function(){var e=A(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I[l].apiComment({id:n,offset:20*(S-1),limit:w.T1});case 3:t=e.sent,p(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),M=function(){var e=A(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R();case 2:return e.next=4,Z();case 4:E(!1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),z=(0,r.useMemo)((function(){return I[l].header}),[l]);return(0,r.useEffect)((function(){b?M():Z()}),[S]),b?a().createElement("div",{className:"w-full h-full flex-center"},a().createElement(m.Z,null)):a().createElement("div",{className:"domComment overflow-auto px-8 py-5 h-full"},a().createElement(z,{detail:i}),a().createElement("div",{className:"domComment_write mt-4"},a().createElement(g.Z,{onChange:P,max:140}),a().createElement("div",{className:"domComment_write_actions flex mt-2.5"},a().createElement("div",{className:"flex space-x-2"},a().createElement("button",{type:"button",className:"text-gray-500 hover:text-black"},a().createElement(x.IconMoodSmile,{size:20,stroke:1.5})),a().createElement("button",{type:"button",className:"text-gray-500 hover:text-black"},a().createElement(x.IconAt,{size:20,stroke:1.5})),a().createElement("button",{type:"button",className:"text-gray-500 hover:text-black"},a().createElement(x.IconHash,{size:20,stroke:1.5}))),a().createElement("button",{type:"button",className:"ui_btn flex-center border px-4 h-8 text-sm hover:bg-gray-100 rounded-full ml-auto"},"评论"))),a().createElement("div",{className:"domComment_main mt-8"},a().createElement(k.Z,{comments:d,more:n,type:l}),a().createElement(N.Z,{total:Math.ceil(d.total/w.T1),page:S,func:j})))})),R=function(){return a().createElement(o.Routes,null,a().createElement(o.Route,{path:":type/:id"},a().createElement(o.Route,{index:!0,element:a().createElement(j,null)}),a().createElement(o.Route,{path:"hot",element:a().createElement(E,null)})))}}}]);
//# sourceMappingURL=Comment.js.map?version=24db93d8