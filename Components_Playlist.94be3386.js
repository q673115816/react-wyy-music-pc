(self.webpackChunkwyy=self.webpackChunkwyy||[]).push([[123],{4359:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>Z});var n=a(3804),r=a.n(n),l=a(5325),s=a(8748),c=a(2137),o=a(9351),m=a(7757),i=a.n(m),u=(a(8309),a(9600),a(1249),a(7484)),f=a.n(u),d=a(847),p=a(4184),v=a.n(p),g=a(9965),E=a(898),h={song:function(e){return r().createElement("span",null,"单曲：「",e.song.name,e.song.alias.length>0&&r().createElement("span",{className:"text-gray-400"},"（".concat(e.song.alias.join(","),"）")),"」")},album:function(e){return r().createElement("span",null,"专辑：「",e.album.name,"」")},topic:function(e){return r().createElement("span",null,"专栏文章：「",e.topic.title,"」")},promotionUrl:function(e){return r().createElement("span",null,e.promotionUrl.text,"：「",e.msg,"」")},picInfo:function(){return"[图片]"}},x=["私信","评论","@我","通知"];const b=function(){var e=(0,l.useDispatch)(),t=(0,l.useSelector)((function(e){return e.common})),a=t.isLogin,m=t.newMsgCount,u=t.msgs,p=void 0===u?[]:u,b=t.comments,y=void 0===b?[]:b,N=t.forwards,w=void 0===N?[]:N,k=t.notices,I=void 0===k?[]:k,S=(0,n.useState)([]),_=(0,o.Z)(S,2),C=_[0],U=_[1],M=(0,n.useState)("私信"),z=(0,o.Z)(M,2),P=z[0],Z=z[1],D=function(){var t=(0,c.Z)(i().mark((function t(a){var n,r,l,s,c;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,a();case 3:n=t.sent,r=n.msgs,l=n.comments,s=n.forwards,c=n.notices,e((0,E.P6)({msgs:r,comments:l,forwards:s,notices:c})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),console.log(t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(e){return t.apply(this,arguments)}}(),L=function(e){Z(e),"私信"===e?(D(g.fy),U(p)):"评论"===e?(D(g.sj),U(y)):"@我"===e?(D(g.LD),U(w)):"通知"===e&&(D(g.$F),U(I))};(0,n.useEffect)((function(){L(P)}),[]);var H=function(){var t=(0,c.Z)(i().mark((function t(a,n){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e((0,s.d)({uid:a,nickname:n,showMsgPrivateHistory:!0}));case 1:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}();return r().createElement(r().Fragment,null,r().createElement("div",{className:"header flex items-baseline p-6 pb-b"},r().createElement("span",{className:"title text-lg"},"消息"),a?r().createElement("button",{type:"button",className:"clear text-sm font-bold ml-auto ui_link"},"一键已读"):r().createElement("span",{className:"clear text-sm font-bold ml-auto ui_disabled"},"一键已读")),r().createElement("div",{className:"nav flex-none flex m-auto w-min rounded-full border"},x.map((function(e){return r().createElement("button",{onClick:function(){return L(e)},type:"button",key:e,className:v()("nav_link relative w-20 h-8 rounded-full",P===e?"bg-gray-400 text-white":"hover:bg-gray-200")},e,"私信"===e&&r().createElement("span",{className:"lt_ico border border-white rounded-full leading-tight px-1 absolute top-0 right-0 bg-red-500 transform translate-x-1/2 -translate-y-1/2 z-10"},m))}))),r().createElement("div",{className:"list mt-3 overflow-auto max-h-full flex-auto"},C.length>0?C.map((function(e){var t;return r().createElement("div",{className:"item flex pr-4 pt-4 hover:bg-gray-100",key:e.fromUser.userId},r().createElement("div",{className:"w-4 flex-center h-8"},e.newMsgCount>0&&r().createElement("i",{className:"rounded-full w-1.5 h-1.5 bg-red-500"})),r().createElement(d.Link,{to:"/user/".concat(e.fromUser.userId),className:"avatar w-8 h-8 relative flex-none"},r().createElement("img",{className:"rounded-full",src:e.fromUser.avatarUrl,alt:""}),r().createElement("i",{className:"ico absolute right-0 bottom-0 w-3.5 h-3.5"},r().createElement("img",{className:"ui_containimg",src:null===(t=e.fromUser.avatarDetail)||void 0===t?void 0:t.identityIconUrl,alt:""}))),r().createElement("button",{type:"button",className:"content border-b pb-3 flex-auto text-left ml-2.5 w-0",onClick:function(){return H(e.fromUser.userId,e.fromUser.nickname)}},r().createElement("div",{className:"top flex"},r().createElement("span",{className:"ui_link"},e.fromUser.nickname),r().createElement("span",{className:"time ml-auto text-gray-400"},f()(e.lastMsgTime).format("YYYY年MM月DD日"))),r().createElement("div",{className:"bottom truncate"},function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0,a=["song","album","topic","promotionUrl","picInfo"];t<a.length;t++){var n=a[t];if(e[n])return h[n](e)}return e.msg}(JSON.parse(e.lastMsg)))))})):r().createElement("div",{className:"empty"},"暂无",P,"内容")))};a(5069);var y=a(2316),N=a(7443),w=a(5200),k=a(5463),I=a(3661),S=function(e){var t=e.msg,a=void 0===t?{}:t;return r().createElement("button",{type:"button",className:"share w-56 flex rounded p-2 bg-gray-50 mt-2"},r().createElement("div",{className:"avatar flex-none w-10 h-10 rounded relative overflow-hidden"},r().createElement("img",{src:"".concat(a.song.album.picUrl,"?param=100y100"),alt:""}),r().createElement("i",{className:"absolute inset-0 m-auto w-6 h-6 bg-white bg-opacity-90 flex-center rounded-full ui_themeColor"},r().createElement(w.IconPlayerPlay,{size:14,className:"fill-current"}))),r().createElement("div",{className:"content flex-auto w-0 pl-2.5 text-left"},r().createElement("div",{className:"name truncate"},a.song.name,a.song.alias.length>0&&r().createElement("span",{className:"text-gray-400"},"（".concat(a.song.alias.join(","),"）"))),r().createElement("div",{className:"text-gray-400 artist truncate"},a.song.artists.map((function(e,t){return r().createElement("span",{key:e.name},t>0&&" / ",e.name)})))))},_=function(e){var t=e.msg,a=void 0===t?{}:t;return r().createElement(d.Link,{to:"/playlist/album/".concat(a.album.id),className:"share flex rounded p-2 bg-gray-50 mt-2 w-56"},r().createElement("button",{type:"button",className:"avatar flex-none w-10 h-10 rounded relative overflow-hidden group"},r().createElement("img",{src:"".concat(a.album.picUrl,"?param=100y100"),alt:""}),r().createElement("i",{className:"absolute opacity-0 group-hover:opacity-100 inset-0 m-auto w-6 h-6 bg-white bg-opacity-90 flex-center rounded-full ui_themeColor"},r().createElement(w.IconPlayerPlay,{size:14,className:"fill-current"}))),r().createElement("div",{className:"content flex-auto w-0 pl-2.5 text-left"},r().createElement("div",{className:"name truncate"},a.album.name,a.album.alias.length>0&&r().createElement("span",{className:"text-gray-400"},"（".concat(a.album.alias.join(","),"）"))),r().createElement("div",{className:"text-gray-400 artist truncate"},a.album.artist.name)))},C=function(e){var t=e.msg,a=void 0===t?{}:t;return r().createElement("div",{className:"img"},r().createElement("img",{src:a.picInfo.picUrl,className:"",alt:""}))},U=function(e){var t=e.msg,a=void 0===t?{}:t,n=a.type;return 16===n?r().createElement(C,{msg:a}):r().createElement(r().Fragment,null,(0,y.j)(a.msg),1===n&&r().createElement(S,{msg:a}),2===n&&r().createElement(_,{msg:a}))},M=function(e){var t=e.msg,a=void 0===t?{}:t;return r().createElement("div",{className:"flex"},r().createElement("div",{className:"w-60 flex"},r().createElement("div",{className:"rounded-lg rounded-tl-none bg-blue-50 p-3 select-text"},r().createElement(U,{msg:a}))))},z=function(e){var t=e.msg,a=void 0===t?{}:t;return r().createElement("div",{className:"flex"},r().createElement("div",{className:"ml-auto w-60 flex"},r().createElement("div",{className:"ml-auto rounded-lg rounded-br-none bg-blue-50 p-3 select-text"},r().createElement(U,{msg:a}))))};const P=function(){var e=(0,l.useDispatch)(),t=(0,n.useRef)(),a=(0,l.useSelector)((function(e){return e.letter})),m=a.uid,u=a.hint,d=a.nickname,p=a.privatMsgs,v=(0,l.useSelector)((function(e){return e.account})).profile,E=(0,n.useState)(!1),h=(0,o.Z)(E,2),x=h[0],b=h[1],y=(0,n.useState)(""),S=(0,o.Z)(y,2),_=S[0],C=S[1],U=function(){var a=(0,c.Z)(i().mark((function a(){var n,r,l,c;return i().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,g.$0)({uid:m});case 3:n=a.sent,r=n.hint,l=n.msgs,c=void 0===l?[]:l,e((0,s.d)({hint:r,privatMsgs:c.reverse()})),t.current.scrollTo(0,t.current.scrollHeight),a.next=14;break;case 11:a.prev=11,a.t0=a.catch(0),console.log(a.t0);case 14:case"end":return a.stop()}}),a,null,[[0,11]])})));return function(){return a.apply(this,arguments)}}(),P=function(){var t=(0,c.Z)(i().mark((function t(){var a,n,r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,g.oF)({user_ids:m,msg:_});case 3:a=t.sent,n=a.newMsgs,r=void 0===n?[]:n,e((0,s.d)({privatMsgs:r.reverse()})),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),console.log(t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(){return t.apply(this,arguments)}}();return(0,n.useEffect)((function(){U()}),[m]),r().createElement(r().Fragment,null,r().createElement("div",{className:"topbar relative text-center text-sm flex-center",style:{height:50}},r().createElement("button",{type:"button",className:"back absolute inset-y-0 left-0 p-2.5 flex-center ui_text_gray_hover",onClick:function(){return e((0,s.d)({showMsgPrivateHistory:!1}))}},r().createElement(w.IconChevronLeft,{size:22})),r().createElement("span",null,d)),r().createElement("div",{className:"history overflow-auto max-h-full flex-auto px-5",ref:t},p.map((function(e){return r().createElement("div",{className:"item mt-5",key:e.id},r().createElement("div",{className:"time text-gray-400"},f()(e.time).format("YYYY年MM月DD日 HH:mm")),e.toUser.userId===v.userId?r().createElement("div",{className:"msg flex justify-start"},r().createElement("div",{className:"avatar flex-none mr-4 rounded-full overflow-hidden w-8 h-8"},r().createElement("img",{className:"",src:e.fromUser.avatarUrl,alt:""})),r().createElement(M,{msg:JSON.parse(e.msg)})):r().createElement(z,{msg:JSON.parse(e.msg)}))})),u&&r().createElement("div",{className:"hint"},u)),r().createElement("div",{className:"feedback p-3"},r().createElement(I.Z,{value:_,setValue:C,length:200,placeholder:"回复 ".concat(d)}),r().createElement("div",{className:"actions flex mt-2.5"},r().createElement("div",{className:"left relative"},x&&r().createElement("div",{className:"-translate-x-3 -translate-y-1/2 absolute faces right-full top-1/2 transform"},r().createElement(k.Z,{handleHide:function(){return b(!1)},clickface:function(e){C(_+e)}})),r().createElement("button",{type:"button",className:"action",onClick:function(){return b(!x)}},r().createElement(w.IconMoodSmile,{size:24,stroke:1.4})),r().createElement("button",{type:"button",className:"action"},r().createElement(w.IconPhoto,{size:24,stroke:1.4}))),r().createElement("button",{type:"button",className:"ml-auto border px-4 h-8 rounded-full",onClick:function(){(0,N.XA)(_)<=200?(P(),C("")):console.log("to long")}},"发送"))))},Z=function(){var e=(0,l.useSelector)((function(e){return e.letter})).showMsgPrivateHistory,t=(0,l.useSelector)((function(e){return e.mask})).popupStatus,a=(0,l.useDispatch)();return(0,n.useEffect)((function(){return function(){a((0,s.d)({showMsgPrivateHistory:!1}))}}),[]),"letter"!==t?null:r().createElement("div",{id:"privateLetter",className:"flex flex-col absolute z-40"},e?r().createElement(P,null):r().createElement(b,null))}},8498:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var n=a(9351),r=(a(1249),a(8309),a(3804)),l=a.n(r),s=a(5325),c=a(4184),o=a.n(c),m=a(7484),i=a.n(m),u=a(847),f=a(5200),d=a(5380),p=a(9703),v=a(2446),g=a(5721),E=function(){var e=(0,s.useDispatch)();return l().createElement("div",{className:"empty w-min m-auto pt-20 whitespace-nowrap"},l().createElement("div",{className:"text-gray-400 text-sm text"},"您还没添加任何歌曲！"),l().createElement("div",{className:"text-gray-400 mt-6"},"去首页",l().createElement(u.Link,{to:"/",className:"ui_text_black_hover underline",onClick:function(){return e((0,p.Es)({}))}},"发现音乐")))},h=function(e){var t=e.list,a=void 0===t?[]:t,n=e.currentId,r=e.current,c=void 0===r?"":r;if(0===a.length)return l().createElement(E,null);var m=(0,s.useSelector)((function(e){return e.audio})).running;return l().createElement("div",null,a.map((function(e,t){return l().createElement(g.Z,{schema:[["评论","播放"],["收藏到歌单","分享","复制链接","不感兴趣","下载"]],type:"song",item:e,key:e.id},l().createElement("div",{tabIndex:"2",className:o()("flex items-center hover:bg-gray-100 focus:bg-gray-200 focus:outline-none h-9 group ",{"bg-gray-50":t%2==1,ui_themeColor:"playlist"===c&&e.id===n})},l().createElement("div",{className:"w-6 flex-center flex-none"},"playlist"===c&&e.id===n&&(m?l().createElement(f.IconPlayerPlay,{className:"fill-current ui_themeColor",size:12}):l().createElement(f.IconPlayerPause,{size:12,className:"fill-current ui_themeColor",stroke:1}))),l().createElement("div",{className:"name flex-auto w-0"},l().createElement(v.Z,{item:e})),l().createElement("div",{className:"w-24 px-1 flex-none truncate text-gray-500 group-hover:text-black"},e.ar.map((function(e,t){return l().createElement("span",{key:e.id},t>0&&" / ",l().createElement(u.Link,{to:"/artist/".concat(e.id)},e.name))}))),l().createElement("div",{className:"w-8 px-1 flex-none"},l().createElement(u.Link,{to:"/"},l().createElement(f.IconLink,{size:16,stroke:1}))),l().createElement("div",{className:"w-16 px-1 flex-none text-gray-300 group-hover:text-black"},i()(e.dt).format("mm:ss"))))})))},x=[{name:"播放列表",code:"playlist"},{name:"历史记录",code:"history"}];const b=function(){var e=(0,s.useDispatch)(),t=(0,s.useSelector)((function(e){return e.mask})).popupStatus,a=(0,s.useSelector)((function(e){return e.audio})),c=a.currentSong,m=(a.playlist,a.history,(0,r.useState)("playlist")),i=(0,n.Z)(m,2),u=i[0],p=i[1];return"playlist"!==t?null:l().createElement("div",{id:"playlist",className:"absolute right-0 shadow bg-white z-40 flex flex-col"},l().createElement("div",{className:"px-5 flex-none"},l().createElement("div",{className:"nav my-5 border w-min flex rounded-full m-auto"},x.map((function(e){var t=e.name,a=e.code;return l().createElement("button",{key:t,type:"button",className:o()("nav_link w-24 h-8 rounded-full",a===u?"bg-gray-400 text-white":"hover:bg-gray-200"),onClick:function(){return p(a)}},t)}))),l().createElement("div",{className:"actions flex items-center pb-2.5 border-b"},l().createElement("span",{className:"text-gray-400"},"总",a[u].length,"首"),l().createElement("div",{className:"right ml-auto flex divide-x"},"playlist"===u&&l().createElement("button",{type:"button",className:o()("action px-5 flex-center",{"text-gray-300":0===a[u].length})},l().createElement(f.IconFolderPlus,{size:20,stroke:1}),"收藏全部"),l().createElement("button",{type:"button",onClick:function(){if(0===a[u].length)return!1;switch(u){case"playlist":return e((0,d.eH)());case"history":return e((0,d.zz)())}},className:o()("action px-5 flex-center",{"text-gray-300":0===a[u].length})},l().createElement(f.IconTrash,{size:20,stroke:1}),"清空")))),l().createElement("div",{className:"overflow-auto h-full flex-auto"},l().createElement(h,{list:a[u],current:u,currentId:c.id})))}}}]);