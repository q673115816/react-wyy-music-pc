{"version":3,"file":"User_Edit.b2067305.js","mappings":"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","sources":["webpack://wyy/./src/components/Dialog/UploadAvatar/index.tsx","webpack://wyy/./src/pages/User/Edit/components/Birthday.tsx","webpack://wyy/./src/pages/User/Edit/index.tsx"],"sourcesContent":["import React from 'react';\nimport { useSelector } from 'react-redux';\nimport HOCDialog from '../Dialog';\nimport './style.scss';\n\nexport default () => {\n  const { dialogUploadAvatarVisibility, avatar } = useSelector(({ mask }) => mask);\n  if (!dialogUploadAvatarVisibility) return null;\n  console.log(avatar);\n  return (\n    <HOCDialog id=\"dialogUploadAvatar\" title=\"上传头像\">\n      <div className=\"main\">\n        <div className=\"content flex justify-center\">\n          <div className=\"fullSize flex-center bg-black rounded overflow-hidden\">\n            {/* <span className=\"\">请选择不超过5M的图片</span> */}\n            <img className=\"w-full h-full object-contain\" src={avatar} alt=\"\" />\n          </div>\n          <div className=\"aside ml-8\">\n            <div className=\"bigSize border rounded w-24 h-24\">\n              <img src={avatar} alt=\"\" />\n            </div>\n            <div className=\"text-gray-400 mt-1\">大尺寸封面</div>\n            <div className=\"smallSize border rounded w-16 h-16\">\n              <img src={avatar} alt=\"\" />\n            </div>\n            <div className=\"text-gray-400 mt-1\">小尺寸封面</div>\n          </div>\n        </div>\n        <div className=\"actions pb-4 pt-6 space-x-4 flex justify-center\">\n          <button type=\"button\" className=\"flex-center border px-3 h-8 rounded-full\">重新选择</button>\n          <button type=\"button\" className=\"flex-center text-white ui_theme_bg_color px-3 h-8 rounded-full\">保持并关闭</button>\n        </div>\n      </div>\n    </HOCDialog>\n  );\n};\n","import React, { useRef, useState, useEffect } from 'react';\n\nexport default ({ birthday = '', handleEdit }) => {\n  const nowYear = useRef(new Date().getFullYear());\n  const year = useRef(new Date(birthday).getFullYear());\n  const month = useRef(new Date(birthday).getMonth());\n  const day = useRef(new Date(birthday).getDate());\n  const [oneMonth, setOneMonth] = useState();\n  // console.log('year', year);\n  // console.log('%centry DomBirthday', 'color: #fcc');\n\n  const callhandleEdit = () => {\n    handleEdit('birthday', new Date(`${year.current}/${month.current + 1}/${day.current}`).valueOf());\n  };\n\n  const handleMonthLenChange = () => {\n    // console.log('month');\n    switch (Number(month.current)) {\n      case 1:\n        if ((year.current % 4 === 0 && year.current % 100 !== 0)\n          || year.current % 400 === 0) {\n          // 闰年\n          setOneMonth(29);\n        } else {\n          setOneMonth(28);\n        }\n        return;\n      case 0:\n      case 2:\n      case 4:\n      case 6:\n      case 7:\n      case 9:\n      case 11:\n        setOneMonth(31);\n        return;\n      default:\n        setOneMonth(30);\n    }\n  };\n\n  const handleYear = (e) => {\n    year.current = e.target.value;\n    month.current = 0;\n    day.current = 1;\n    // handleMonthLenChange();\n    callhandleEdit();\n  };\n\n  const handleMonth = (e) => {\n    month.current = e.target.value;\n    day.current = 1;\n    // handleMonthLenChange();\n    callhandleEdit();\n  };\n\n  const handleDay = (e) => {\n    day.current = e.target.value;\n    callhandleEdit();\n  };\n  useEffect(() => {\n    handleMonthLenChange();\n  }, [month.current]);\n\n  return (\n    <>\n      <select className=\"select\" value={year.current} onChange={handleYear}>\n        {Object.keys(Array(100).fill(0)).reverse().map((item) => (\n          <option\n            key={nowYear.current - item}\n            value={nowYear.current - item}\n          >\n            {nowYear.current - item}\n            年\n          </option>\n        ))}\n      </select>\n      <select className=\"select\" value={month.current} onChange={handleMonth}>\n        {Object.keys(Array(12).fill(0)).map((item) => (\n          <option\n            key={item}\n            value={item}\n          >\n            {Number(item) + 1}\n            月\n          </option>\n        ))}\n      </select>\n      <select className=\"select\" value={day.current} onChange={handleDay}>\n        {Object.keys(Array(oneMonth).fill(0)).map((item) => (\n          <option\n            key={Number(item) + 1}\n            value={Number(item) + 1}\n          >\n            {Number(item) + 1}\n            日\n          </option>\n        ))}\n      </select>\n    </>\n  );\n};\n","import React, {\n  memo, useEffect, useRef, useState,\n} from 'react';\nimport { apiUserDetail, apiUserUpdate } from '@/api';\nimport { Link } from 'react-router-dom';\nimport classNames from 'classnames';\nimport produce from 'immer';\nimport { setToast, setDialogUploadAvatarShow } from '@/reducers/mask/slice';\nimport { useDispatch } from 'react-redux';\nimport './style.scss';\nimport DomLoading from '@/components/Loading';\nimport DialogUploadAvatar from '@/components/Dialog/UploadAvatar';\nimport DomBirthday from './components/Birthday';\n\nexport default memo(({ uid }) => {\n  const dispatch = useDispatch();\n  const [loading, setLoading] = useState(true);\n  const [profile, setProfile] = useState();\n  const [edit, setEdit] = useState();\n\n  const [signature, setSignature] = useState('');\n  const [disabled, setDisabled] = useState(true);\n  const handleInit = async () => {\n    try {\n      const {\n        code, profile,\n      } = await apiUserDetail({\n        uid,\n      });\n      if (code !== 200) return;\n      setProfile(profile);\n      setEdit(() => produce(profile, () => { }));\n    } catch (error) {\n      console.log(error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSave = async () => {\n    try {\n      const params = {\n        gender: edit.gender,\n        birthday: edit.birthday,\n        nickname: edit.nickname,\n        province: edit.province,\n        city: edit.city,\n        signature: edit.signature,\n      };\n      const { code } = await apiUserUpdate(params);\n      if (code !== 200) return;\n      setDisabled(true);\n      setProfile(edit);\n      dispatch(setToast('修改个人资料成功'));\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const handleEdit = (name, value) => {\n    setEdit(produce((draft) => {\n      draft[name] = value;\n    }));\n  };\n\n  const handleUpload = ({ target }) => {\n    // console.log(target);\n    const reader = new FileReader();\n    const [file] = target.files;\n    if (!file) return;\n    reader.readAsDataURL(file);\n    reader.onload = (event) => {\n      dispatch(setDialogUploadAvatarShow({\n        avatar: event.target.result,\n      }));\n    };\n  };\n\n  useEffect(() => {\n    handleInit();\n  }, [uid]);\n\n  useEffect(() => {\n    // console.log(initialState.current === edit);\n    // console.log(JSON.stringify(profile) === JSON.stringify(edit));\n    // 可以保存修改值判断\n    setDisabled(JSON.stringify(profile) === JSON.stringify(edit));\n  }, [edit]);\n\n  if (loading) return <div className=\"flex-center w-full h-full\"><DomLoading /></div>;\n  return (\n    <div className=\"domUserEdit\">\n      <div className=\"h1 domUser_subpage_header ui_header\">\n        编辑个人信息\n      </div>\n      <div className=\"domUserEdit_main\">\n        <div className=\"left\">\n          <div className=\"row\">\n            <div className=\"key\">昵称：</div>\n            <div className=\"value\">\n              <input\n                type=\"text\"\n                value={edit.nickname}\n                className=\"input\"\n                onChange={({ target }) => handleEdit('nickname', target.value)}\n              />\n            </div>\n          </div>\n          <div className=\"row\">\n            <div className=\"key\">介绍：</div>\n            <div className=\"value\">\n              <div className=\"signature\">\n                <textarea\n                  type=\"text\"\n                  value={edit.signature}\n                  className=\"textarea\"\n                  onChange={({ target }) => handleEdit('signature', target.value)}\n                />\n                <div className={classNames('signatureLength', { ui_red: signature.length > 300 })}>\n                  {300 - signature.length}\n                </div>\n              </div>\n            </div>\n          </div>\n          <div className=\"row\">\n            <div className=\"key\">性别：</div>\n            <div className=\"value\">\n              <label htmlFor=\"secret\" className=\"gender\">\n                <input\n                  type=\"radio\"\n                  className=\"radio\"\n                  name=\"gender\"\n                  id=\"secret\"\n                  checked={edit.gender === 0}\n                  onChange={() => handleEdit('gender', 0)}\n                />\n                <i className=\"ico flex-center\" />\n                <span>保密</span>\n              </label>\n              <label htmlFor=\"male\" className=\"gender\">\n                <input\n                  type=\"radio\"\n                  className=\"radio\"\n                  name=\"gender\"\n                  id=\"male\"\n                  checked={edit.gender === 1}\n                  onChange={() => handleEdit('gender', 1)}\n                />\n                <i className=\"ico flex-center\" />\n                <span>男</span>\n              </label>\n              <label htmlFor=\"famale\" className=\"gender\">\n                <input\n                  type=\"radio\"\n                  className=\"radio\"\n                  name=\"gender\"\n                  id=\"famale\"\n                  checked={edit.gender === 2}\n                  onChange={() => handleEdit('gender', 2)}\n                />\n                <i className=\"ico flex-center\" />\n                <span>女</span>\n              </label>\n            </div>\n          </div>\n          <div className=\"row\">\n            <div className=\"key\">生日：</div>\n            <div className=\"value\" style={{ display: 'flex', justifyContent: 'space-between' }}>\n              <DomBirthday\n                birthday={edit.birthday}\n                handleEdit={handleEdit}\n              />\n            </div>\n          </div>\n          <div className=\"row\">\n            <div className=\"key\">地区：</div>\n            <div className=\"value\">\n              <select name=\"\" id=\"\" className=\"select\">\n                <option value=\"\" />\n              </select>\n            </div>\n          </div>\n          <div className=\"row\">\n            <div className=\"key\" />\n            <div className=\"value\">\n              <div className=\"actions\">\n                <button\n                  type=\"button\"\n                  className={classNames('ui_btn inline-flex items-center justify-center border px-3 h-8 rounded-full red', { disabled })}\n                  style={{ marginRight: '2em' }}\n                  disabled={disabled}\n                  onClick={handleSave}\n                >\n                  保&nbsp;存\n\n                </button>\n                <Link to=\"./\" className=\"ui_btn inline-flex items-center justify-center border px-3 h-8 rounded-full\">取&nbsp;消</Link>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div className=\"right ml-20\">\n          <div className=\"avatar border rounded overflow-hidden w-40 h-40\">\n            <img className=\"\" src={edit.avatarUrl} alt=\"\" />\n          </div>\n          <label htmlFor=\"avatar\" className=\"border cursor-pointer hover:bg-gray-50 flex-center h-8 m-auto mt-5 px-3 rounded-full update w-min whitespace-nowrap\">\n            <input\n              onChange={handleUpload}\n              type=\"file\"\n              name=\"\"\n              id=\"avatar\"\n              hidden\n              accept=\"image/bmp,image/gif,image/jpg,image/svg,image/png,image/webp,image/ico,image/svgz,image/tif,image/jpeg,image/jfif,image/pjpeg,image/pjp,image/tiff,image/xbm\"\n            />\n            修改头像\n          </label>\n          <DialogUploadAvatar />\n        </div>\n      </div>\n    </div>\n  );\n});\n"],"names":["useSelector","mask","dialogUploadAvatarVisibility","avatar","console","log","id","title","className","src","alt","type","birthday","handleEdit","nowYear","useRef","Date","getFullYear","year","month","getMonth","day","getDate","useState","oneMonth","setOneMonth","callhandleEdit","current","valueOf","useEffect","Number","handleMonthLenChange","value","onChange","e","target","Object","keys","Array","fill","reverse","map","item","key","memo","uid","dispatch","useDispatch","loading","setLoading","profile","setProfile","edit","setEdit","signature","disabled","setDisabled","handleInit","apiUserDetail","code","produce","handleSave","params","gender","nickname","province","city","apiUserUpdate","setToast","name","draft","JSON","stringify","classNames","ui_red","length","htmlFor","checked","style","display","justifyContent","marginRight","onClick","Link","to","avatarUrl","reader","FileReader","file","files","readAsDataURL","onload","event","setDialogUploadAvatarShow","result","hidden","accept"],"sourceRoot":""}