{"version":3,"file":"AllMV.1dfe23fa.js","mappings":"+cAAA,e,aACA,WACA,W,aAEA,W,aACA,W,aACA,W,qrBAEA,IAAMA,EAAU,CACd,CAAC,OAAQ,KAAM,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,OAC9C,CAAC,OAAQ,KAAM,CAAC,KAAM,MAAO,KAAM,MAAO,SAC1C,CAAC,QAAS,KAAM,CAAC,OAAQ,KAAM,QAG3BC,EAAyC,CAC7CC,KAAM,KACNC,KAAM,KACNC,MAAO,Q,iBAGM,IAAAC,OAAK,WAClB,IADwB,EAChBC,GAAW,IAAAC,eAAXD,OAGFE,GAAS,IAAAC,QAAO,GAEhBC,EAAc,IAAIC,gBAAgBL,GAClCM,GAAY,IAAAH,QAAO,MACnBI,GAAc,IAAAJ,QAAO,MARH,E,25BAAA,CASHC,GATG,IASxB,2BAAkC,gCAAtBI,EAAsB,KAAnBC,EAAmB,KAChCd,EAAca,GAAKC,GAVG,8BAaxB,OAAwB,IAAAC,UAAS,IAAjC,qBAAOC,EAAP,KAAaC,EAAb,KAEMC,EAAU,+CAAG,sHASQ,IAAAC,UAAA,OAClBnB,GADkB,IAErBoB,MAvBQ,GAwBRb,OAAQA,EAAOc,WAZF,gBASPL,EATO,EASPA,KAKRT,EAAOc,SA1BG,GA2BVJ,GAAQ,SAACK,GAAD,8BAAcA,IAAd,aAAuBN,EAAKO,KAAI,gBACtCC,EADsC,EACtCA,GAAIC,EADkC,EAClCA,KAAMC,EAD4B,EAC5BA,MAAOC,EADqB,EACrBA,UADqB,MAEjC,CACLH,GAAAA,EACAE,MAAAA,EACAE,SALsC,EACVA,SAK5BD,UAAAA,EACAE,MAAOJ,EACPK,QARsC,EACAC,QAOrBR,KAAI,kBAAqC,CAAES,OAAvC,EAAGR,GAA4CS,SAA/C,EAAeR,kBAvBvB,gDA0BfS,QAAQC,IAAR,MA1Be,yDAAH,qDA6ChB,OAhBA,aAAYjB,EAAYP,EAAWC,EAAa,CAACP,KAUjD,IAAA+B,YAAU,WACRnB,EAAQ,IACRV,EAAOc,QAAU,IAEhB,CAAChB,IAGF,+BAAKgC,UAAU,gCAAgCC,IAAK3B,GAClD,+BAAK0B,UAAU,6BACb,wBAAC,EAAAE,KAAD,CAAMC,GAAG,KAAKH,UAAU,YAAxB,SAIF,+BAAKA,UAAU,gCACb,+BAAKA,UAAU,aAEXtC,EAAQwB,KAAI,SAACkB,GAAD,OACV,+BAAKJ,UAAU,kBAAkBK,IAAKD,EAAO,IAC3C,+BAAKJ,UAAU,kBACZI,EAAO,GADV,KAIA,+BAAKJ,UAAU,iBAEXI,EAAO,GAAGlB,KAAI,SAACoB,GAAD,OACZ,+BAAKN,UAAU,mBAAmBK,IAAKC,GACrC,wBAAC,EAAAJ,KAAD,CACEC,GAAE,iBAAY,IAAI9B,gBAAJ,OAAyBV,IAAzB,gBAA8CyC,EAAO,GAAKE,MACxEN,WAAW,aAAW,oDAAqDM,IAAS3C,EAAcyC,EAAO,IAAM,yBAA2B,uBAEzIE,aAUnB,+BAAKN,UAAU,QACb,wBAAC,UAAD,CAAcO,KAAM5B,KAEtB,+BAAKsB,IAAK1B","sources":["webpack://wyy/./src/pages/AllMV/index.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState, memo } from 'react';\nimport { Link, useLocation } from 'react-router-dom';\nimport classNames from 'classnames';\nimport {useQuery} from 'react-query'\nimport DomGridVideo from '@/components/GridVideo';\nimport useInfinite from '@/hooks/useInfinite';\nimport { apiMVAll } from '@/api';\n\nconst filters = [\n  ['area', '地区', ['全部', '内地', '港台', '欧美', '韩国', '日本']],\n  ['type', '类型', ['全部', '官方版', '原声', '现场版', '网易出品']],\n  ['order', '排序', ['上升最快', '最热', '最新']],\n];\n\nconst defaultSearch: {[key: string]: string} = {\n  area: '全部',\n  type: '全部',\n  order: '上升最快',\n};\n\nexport default memo(() => {\n  const { search } = useLocation();\n\n  const limit = 30;\n  const offset = useRef(0);\n\n  const queryString = new URLSearchParams(search);\n  const domScroll = useRef(null);\n  const domObserver = useRef(null);\n  for (const [k, v] of queryString) {\n    defaultSearch[k] = v;\n  }\n\n  const [data, setData] = useState([]);\n\n  const handleInit = async () => {\n    try {\n      // const {data} = useQuery('allmv', async () => {\n      //   return await apiMVAll({\n      //     ...defaultSearch,\n      //     limit,\n      //     offset: offset.current,\n      //   });\n      // })\n      const { data } = await apiMVAll({\n        ...defaultSearch,\n        limit,\n        offset: offset.current,\n      });\n      offset.current += limit;\n      setData((prev) => [...prev, ...data.map(({\n        id, name, cover, playCount, duration, artists,\n      }) => ({\n        id,\n        cover,\n        duration,\n        playCount,\n        title: name,\n        creator: artists.map(({ id: userId, name: userName }) => ({ userId, userName })),\n      }))]);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n  useInfinite(handleInit, domScroll, domObserver, [search]);\n\n  // useEffect(() => {\n  //   // handleInit();\n  //   handleIo();\n  //   return () => {\n  //     handleUnIo();\n  //   };\n  // }, [search]);\n\n  useEffect(() => {\n    setData([]);\n    offset.current = 0;\n    // handleInit();\n  }, [search]);\n\n  return (\n    <div className=\"domAllMV overflow-auto h-full\" ref={domScroll}>\n      <div className=\"domAllMV_header ui_header\">\n        <Link to=\"./\" className=\"h1 title\">\n          全部MV\n        </Link>\n      </div>\n      <div className=\"domAllMV_main px-8 flex-auto\">\n        <div className=\"ui_filter\">\n          {\n            filters.map((filter) => (\n              <div className=\"row flex my-2.5\" key={filter[1]}>\n                <div className=\"name flex-none\">\n                  {filter[1]}\n                  :\n                </div>\n                <div className=\"list divide-x\">\n                  {\n                    filter[2].map((item) => (\n                      <div className=\"item flex-center\" key={item}>\n                        <Link\n                          to={`/allmv?${new URLSearchParams({ ...defaultSearch, ...{ [filter[0]]: item } })}`}\n                          className={classNames('btn rounded-full leading-5 px-3 whitespace-nowrap', item === defaultSearch[filter[0]] ? 'bg-red-50 text-red-500' : 'ui_text_gray_hover')}\n                        >\n                          {item}\n                        </Link>\n                      </div>\n                    ))\n                  }\n                </div>\n              </div>\n            ))\n          }\n        </div>\n        <div className=\"py-1\">\n          <DomGridVideo list={data} />\n        </div>\n        <div ref={domObserver} />\n      </div>\n    </div>\n  );\n});\n"],"names":["filters","defaultSearch","area","type","order","memo","search","useLocation","offset","useRef","queryString","URLSearchParams","domScroll","domObserver","k","v","useState","data","setData","handleInit","apiMVAll","limit","current","prev","map","id","name","cover","playCount","duration","title","creator","artists","userId","userName","console","log","useEffect","className","ref","Link","to","filter","key","item","list"],"sourceRoot":""}