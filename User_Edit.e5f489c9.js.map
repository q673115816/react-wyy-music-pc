{"version":3,"file":"User_Edit.e5f489c9.js","mappings":"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","sources":["webpack://wyy/./src/components/Dialog/UploadAvatar/index.tsx","webpack://wyy/./src/pages/User/Edit/components/Birthday.tsx","webpack://wyy/./src/pages/User/Edit/index.tsx"],"sourcesContent":["import React from 'react';\nimport { useSelector } from 'react-redux';\nimport HOCDialog from '../Dialog';\nimport './style.scss';\n\nexport default () => {\n  const { dialogUploadAvatarVisibility, avatar } = useSelector(({ mask }) => mask);\n  if (!dialogUploadAvatarVisibility) return null;\n  console.log(avatar);\n  return (\n    <HOCDialog id=\"dialogUploadAvatar\" title=\"上传头像\">\n      <div className=\"main\">\n        <div className=\"content flex justify-center\">\n          <div className=\"fullSize flex-center bg-black rounded overflow-hidden\">\n            {/* <span className=\"\">请选择不超过5M的图片</span> */}\n            <img className=\"w-full h-full object-contain\" src={avatar} alt=\"\" />\n          </div>\n          <div className=\"aside ml-8\">\n            <div className=\"bigSize border rounded w-24 h-24\">\n              <img src={avatar} alt=\"\" />\n            </div>\n            <div className=\"text-gray-400 mt-1\">大尺寸封面</div>\n            <div className=\"smallSize border rounded w-16 h-16\">\n              <img src={avatar} alt=\"\" />\n            </div>\n            <div className=\"text-gray-400 mt-1\">小尺寸封面</div>\n          </div>\n        </div>\n        <div className=\"actions pb-4 pt-6 space-x-4 flex justify-center\">\n          <button type=\"button\" className=\"flex-center border px-3 h-8 rounded-full\">重新选择</button>\n          <button type=\"button\" className=\"flex-center text-white ui_theme_bg_color px-3 h-8 rounded-full\">保持并关闭</button>\n        </div>\n      </div>\n    </HOCDialog>\n  );\n};\n","import React, { useRef, useState, useEffect } from 'react';\n\nexport default ({ birthday = '', handleEdit }) => {\n  const nowYear = useRef(new Date().getFullYear());\n  const year = useRef(new Date(birthday).getFullYear());\n  const month = useRef(new Date(birthday).getMonth());\n  const day = useRef(new Date(birthday).getDate());\n  const [oneMonth, setOneMonth] = useState();\n  // console.log('year', year);\n  // console.log('%centry DomBirthday', 'color: #fcc');\n\n  const callhandleEdit = () => {\n    handleEdit('birthday', new Date(`${year.current}/${month.current + 1}/${day.current}`).valueOf());\n  };\n\n  const handleMonthLenChange = () => {\n    // console.log('month');\n    switch (Number(month.current)) {\n      case 1:\n        if ((year.current % 4 === 0 && year.current % 100 !== 0)\n          || year.current % 400 === 0) {\n          // 闰年\n          setOneMonth(29);\n        } else {\n          setOneMonth(28);\n        }\n        return;\n      case 0:\n      case 2:\n      case 4:\n      case 6:\n      case 7:\n      case 9:\n      case 11:\n        setOneMonth(31);\n        return;\n      default:\n        setOneMonth(30);\n    }\n  };\n\n  const handleYear = (e) => {\n    year.current = e.target.value;\n    month.current = 0;\n    day.current = 1;\n    // handleMonthLenChange();\n    callhandleEdit();\n  };\n\n  const handleMonth = (e) => {\n    month.current = e.target.value;\n    day.current = 1;\n    // handleMonthLenChange();\n    callhandleEdit();\n  };\n\n  const handleDay = (e) => {\n    day.current = e.target.value;\n    callhandleEdit();\n  };\n  useEffect(() => {\n    handleMonthLenChange();\n  }, [month.current]);\n\n  return (\n    <>\n      <select className=\"select\" value={year.current} onChange={handleYear}>\n        {Object.keys(Array(100).fill(0)).reverse().map((item) => (\n          <option\n            key={nowYear.current - item}\n            value={nowYear.current - item}\n          >\n            {nowYear.current - item}\n            年\n          </option>\n        ))}\n      </select>\n      <select className=\"select\" value={month.current} onChange={handleMonth}>\n        {Object.keys(Array(12).fill(0)).map((item) => (\n          <option\n            key={item}\n            value={item}\n          >\n            {Number(item) + 1}\n            月\n          </option>\n        ))}\n      </select>\n      <select className=\"select\" value={day.current} onChange={handleDay}>\n        {Object.keys(Array(oneMonth).fill(0)).map((item) => (\n          <option\n            key={Number(item) + 1}\n            value={Number(item) + 1}\n          >\n            {Number(item) + 1}\n            日\n          </option>\n        ))}\n      </select>\n    </>\n  );\n};\n","import React, {\n  memo, useEffect, useRef, useState,\n} from 'react';\nimport { apiUserDetail, apiUserUpdate } from '@/api';\nimport { Link } from 'react-router-dom';\nimport classNames from 'classnames';\nimport produce from 'immer';\nimport { setToast, setDialogUploadAvatarShow } from '@/reducers/mask/slice';\nimport { useDispatch } from 'react-redux';\nimport './style.scss';\nimport DomLoading from '@/components/Loading';\nimport DialogUploadAvatar from '@/components/Dialog/UploadAvatar';\nimport DomBirthday from './components/Birthday';\n\nexport default memo(({ uid }) => {\n  const dispatch = useDispatch();\n  const [loading, setLoading] = useState(true);\n  const [profile, setProfile] = useState();\n  const [edit, setEdit] = useState();\n\n  const [signature, setSignature] = useState('');\n  const [disabled, setDisabled] = useState(true);\n  const handleInit = async () => {\n    try {\n      const {\n        code, profile,\n      } = await apiUserDetail({\n        uid,\n      });\n      if (code !== 200) return;\n      setProfile(profile);\n      setEdit(() => produce(profile, () => { }));\n    } catch (error) {\n      console.log(error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSave = async () => {\n    try {\n      const params = {\n        gender: edit.gender,\n        birthday: edit.birthday,\n        nickname: edit.nickname,\n        province: edit.province,\n        city: edit.city,\n        signature: edit.signature,\n      };\n      const { code } = await apiUserUpdate(params);\n      if (code !== 200) return;\n      setDisabled(true);\n      setProfile(edit);\n      dispatch(setToast('修改个人资料成功'));\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const handleEdit = (name, value) => {\n    setEdit(produce((draft) => {\n      draft[name] = value;\n    }));\n  };\n\n  const handleUpload = ({ target }) => {\n    // console.log(target);\n    const reader = new FileReader();\n    const [file] = target.files;\n    if (!file) return;\n    reader.readAsDataURL(file);\n    reader.onload = (event) => {\n      dispatch(setDialogUploadAvatarShow({\n        avatar: event.target.result,\n      }));\n    };\n  };\n\n  useEffect(() => {\n    handleInit();\n  }, [uid]);\n\n  useEffect(() => {\n    // console.log(initialState.current === edit);\n    // console.log(JSON.stringify(profile) === JSON.stringify(edit));\n    // 可以保存修改值判断\n    setDisabled(JSON.stringify(profile) === JSON.stringify(edit));\n  }, [edit]);\n\n  if (loading) return <div className=\"flex-center w-full h-full\"><DomLoading /></div>;\n  return (\n    <div className=\"domUserEdit\">\n      <div className=\"h1 domUser_subpage_header ui_header\">\n        编辑个人信息\n      </div>\n      <div className=\"domUserEdit_main\">\n        <div className=\"left\">\n          <div className=\"row\">\n            <div className=\"key\">昵称：</div>\n            <div className=\"value\">\n              <input\n                type=\"text\"\n                value={edit.nickname}\n                className=\"input\"\n                onChange={({ target }) => handleEdit('nickname', target.value)}\n              />\n            </div>\n          </div>\n          <div className=\"row\">\n            <div className=\"key\">介绍：</div>\n            <div className=\"value\">\n              <div className=\"signature\">\n                <textarea\n                  type=\"text\"\n                  value={edit.signature}\n                  className=\"textarea\"\n                  onChange={({ target }) => handleEdit('signature', target.value)}\n                />\n                <div className={classNames('signatureLength', { ui_red: signature.length > 300 })}>\n                  {300 - signature.length}\n                </div>\n              </div>\n            </div>\n          </div>\n          <div className=\"row\">\n            <div className=\"key\">性别：</div>\n            <div className=\"value\">\n              <label htmlFor=\"secret\" className=\"gender\">\n                <input\n                  type=\"radio\"\n                  className=\"radio\"\n                  name=\"gender\"\n                  id=\"secret\"\n                  checked={edit.gender === 0}\n                  onChange={() => handleEdit('gender', 0)}\n                />\n                <i className=\"ico flex-center\" />\n                <span>保密</span>\n              </label>\n              <label htmlFor=\"male\" className=\"gender\">\n                <input\n                  type=\"radio\"\n                  className=\"radio\"\n                  name=\"gender\"\n                  id=\"male\"\n                  checked={edit.gender === 1}\n                  onChange={() => handleEdit('gender', 1)}\n                />\n                <i className=\"ico flex-center\" />\n                <span>男</span>\n              </label>\n              <label htmlFor=\"famale\" className=\"gender\">\n                <input\n                  type=\"radio\"\n                  className=\"radio\"\n                  name=\"gender\"\n                  id=\"famale\"\n                  checked={edit.gender === 2}\n                  onChange={() => handleEdit('gender', 2)}\n                />\n                <i className=\"ico flex-center\" />\n                <span>女</span>\n              </label>\n            </div>\n          </div>\n          <div className=\"row\">\n            <div className=\"key\">生日：</div>\n            <div className=\"value\" style={{ display: 'flex', justifyContent: 'space-between' }}>\n              <DomBirthday\n                birthday={edit.birthday}\n                handleEdit={handleEdit}\n              />\n            </div>\n          </div>\n          <div className=\"row\">\n            <div className=\"key\">地区：</div>\n            <div className=\"value\">\n              <select name=\"\" id=\"\" className=\"select\">\n                <option value=\"\" />\n              </select>\n            </div>\n          </div>\n          <div className=\"row\">\n            <div className=\"key\" />\n            <div className=\"value\">\n              <div className=\"actions\">\n                <button\n                  type=\"button\"\n                  className={classNames('ui_btn inline-flex items-center justify-center border px-3 h-8 rounded-full red', { disabled })}\n                  style={{ marginRight: '2em' }}\n                  disabled={disabled}\n                  onClick={handleSave}\n                >\n                  保&nbsp;存\n\n                </button>\n                <Link to=\"./\" className=\"ui_btn inline-flex items-center justify-center border px-3 h-8 rounded-full\">取&nbsp;消</Link>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div className=\"right ml-20\">\n          <div className=\"avatar border rounded overflow-hidden w-40 h-40\">\n            <img className=\"\" src={edit.avatarUrl} alt=\"\" />\n          </div>\n          <label htmlFor=\"avatar\" className=\"border cursor-pointer hover:bg-gray-50 flex-center h-8 m-auto mt-5 px-3 rounded-full update w-min whitespace-nowrap\">\n            <input\n              onChange={handleUpload}\n              type=\"file\"\n              name=\"\"\n              id=\"avatar\"\n              hidden\n              accept=\"image/bmp,image/gif,image/jpg,image/svg,image/png,image/webp,image/ico,image/svgz,image/tif,image/jpeg,image/jfif,image/pjpeg,image/pjp,image/tiff,image/xbm\"\n            />\n            修改头像\n          </label>\n          <DialogUploadAvatar />\n        </div>\n      </div>\n    </div>\n  );\n});\n"],"names":["useSelector","mask","dialogUploadAvatarVisibility","avatar","console","log","id","title","className","src","alt","type","birthday","handleEdit","nowYear","useRef","Date","getFullYear","year","month","getMonth","day","getDate","useState","oneMonth","setOneMonth","callhandleEdit","current","valueOf","useEffect","Number","handleMonthLenChange","value","onChange","e","target","Object","keys","Array","fill","reverse","map","item","key","memo","uid","dispatch","useDispatch","loading","setLoading","profile","setProfile","edit","setEdit","signature","disabled","setDisabled","handleInit","apiUserDetail","code","handleSave","params","gender","nickname","province","city","apiUserUpdate","setToast","name","draft","JSON","stringify","ui_red","length","htmlFor","checked","style","display","justifyContent","marginRight","onClick","Link","to","avatarUrl","reader","FileReader","file","files","readAsDataURL","onload","event","setDialogUploadAvatarShow","result","hidden","accept"],"sourceRoot":""}